Resources:
  TestVpcE77CE678:
    Type: AWS::EC2::VPC
    Properties:
      CidrBlock: 10.0.0.0/16
      EnableDnsHostnames: true
      EnableDnsSupport: true
      InstanceTenancy: default
      Tags:
        - Key: Name
          Value: KnexIntegrationTestStack/TestVpc
    Metadata:
      aws:cdk:path: KnexIntegrationTestStack/TestVpc/Resource
  TestVpctestauroraisolatedSubnet1SubnetD1B41E1E:
    Type: AWS::EC2::Subnet
    Properties:
      CidrBlock: 10.0.0.0/17
      VpcId:
        Ref: TestVpcE77CE678
      AvailabilityZone:
        Fn::Select:
          - 0
          - Fn::GetAZs: ""
      MapPublicIpOnLaunch: false
      Tags:
        - Key: aws-cdk:subnet-name
          Value: test_aurora_isolated_
        - Key: aws-cdk:subnet-type
          Value: Isolated
        - Key: Name
          Value: KnexIntegrationTestStack/TestVpc/test_aurora_isolated_Subnet1
    Metadata:
      aws:cdk:path: KnexIntegrationTestStack/TestVpc/test_aurora_isolated_Subnet1/Subnet
  TestVpctestauroraisolatedSubnet1RouteTable690C95C3:
    Type: AWS::EC2::RouteTable
    Properties:
      VpcId:
        Ref: TestVpcE77CE678
      Tags:
        - Key: Name
          Value: KnexIntegrationTestStack/TestVpc/test_aurora_isolated_Subnet1
    Metadata:
      aws:cdk:path: KnexIntegrationTestStack/TestVpc/test_aurora_isolated_Subnet1/RouteTable
  TestVpctestauroraisolatedSubnet1RouteTableAssociationD3E458E8:
    Type: AWS::EC2::SubnetRouteTableAssociation
    Properties:
      RouteTableId:
        Ref: TestVpctestauroraisolatedSubnet1RouteTable690C95C3
      SubnetId:
        Ref: TestVpctestauroraisolatedSubnet1SubnetD1B41E1E
    Metadata:
      aws:cdk:path: KnexIntegrationTestStack/TestVpc/test_aurora_isolated_Subnet1/RouteTableAssociation
  TestVpctestauroraisolatedSubnet2Subnet1B37CA4E:
    Type: AWS::EC2::Subnet
    Properties:
      CidrBlock: 10.0.128.0/17
      VpcId:
        Ref: TestVpcE77CE678
      AvailabilityZone:
        Fn::Select:
          - 1
          - Fn::GetAZs: ""
      MapPublicIpOnLaunch: false
      Tags:
        - Key: aws-cdk:subnet-name
          Value: test_aurora_isolated_
        - Key: aws-cdk:subnet-type
          Value: Isolated
        - Key: Name
          Value: KnexIntegrationTestStack/TestVpc/test_aurora_isolated_Subnet2
    Metadata:
      aws:cdk:path: KnexIntegrationTestStack/TestVpc/test_aurora_isolated_Subnet2/Subnet
  TestVpctestauroraisolatedSubnet2RouteTable55902B1F:
    Type: AWS::EC2::RouteTable
    Properties:
      VpcId:
        Ref: TestVpcE77CE678
      Tags:
        - Key: Name
          Value: KnexIntegrationTestStack/TestVpc/test_aurora_isolated_Subnet2
    Metadata:
      aws:cdk:path: KnexIntegrationTestStack/TestVpc/test_aurora_isolated_Subnet2/RouteTable
  TestVpctestauroraisolatedSubnet2RouteTableAssociation159D8EC2:
    Type: AWS::EC2::SubnetRouteTableAssociation
    Properties:
      RouteTableId:
        Ref: TestVpctestauroraisolatedSubnet2RouteTable55902B1F
      SubnetId:
        Ref: TestVpctestauroraisolatedSubnet2Subnet1B37CA4E
    Metadata:
      aws:cdk:path: KnexIntegrationTestStack/TestVpc/test_aurora_isolated_Subnet2/RouteTableAssociation
  TestAuroraSubnetGroup:
    Type: AWS::RDS::DBSubnetGroup
    Properties:
      DBSubnetGroupDescription: Subnet group to access aurora
      SubnetIds:
        - Ref: TestVpctestauroraisolatedSubnet1SubnetD1B41E1E
        - Ref: TestVpctestauroraisolatedSubnet2Subnet1B37CA4E
      DBSubnetGroupName: test-aurora-serverless-subnet-group
    Metadata:
      aws:cdk:path: KnexIntegrationTestStack/TestAuroraSubnetGroup
  PostgresTestMasterUserSecretF806DC89:
    Type: AWS::SecretsManager::Secret
    Properties:
      Description:
        Fn::Join:
          - ""
          - - "Generated by the CDK for stack: "
            - Ref: AWS::StackName
      GenerateSecretString:
        ExcludeCharacters: " %+~`#$&*()|[]{}:;<>?!'/@\"\\"
        GenerateStringKey: password
        PasswordLength: 30
        SecretStringTemplate: '{"username":"root"}'
      Name: test-cluster
    Metadata:
      aws:cdk:path: KnexIntegrationTestStack/PostgresTestMasterUserSecret/Resource
  PostgresTestAuroraServerless:
    Type: AWS::RDS::DBCluster
    Properties:
      Engine: aurora-postgresql
      DatabaseName: Test
      DBClusterIdentifier: postgres-test-cluster
      DBSubnetGroupName: test-aurora-serverless-subnet-group
      EngineMode: serverless
      MasterUsername:
        Fn::Join:
          - ""
          - - "{{resolve:secretsmanager:"
            - Ref: PostgresTestMasterUserSecretF806DC89
            - :SecretString:username::}}
      MasterUserPassword:
        Fn::Join:
          - ""
          - - "{{resolve:secretsmanager:"
            - Ref: PostgresTestMasterUserSecretF806DC89
            - :SecretString:password::}}
      ScalingConfiguration:
        AutoPause: true
        MaxCapacity: 2
        MinCapacity: 2
        SecondsUntilAutoPause: 3600
    DependsOn:
      - TestAuroraSubnetGroup
    Metadata:
      aws:cdk:path: KnexIntegrationTestStack/PostgresTestAuroraServerless
  MysqlTestAuroraServerless:
    Type: AWS::RDS::DBCluster
    Properties:
      Engine: aurora
      DatabaseName: Test
      DBClusterIdentifier: mysql-test-cluster
      DBSubnetGroupName: test-aurora-serverless-subnet-group
      EngineMode: serverless
      MasterUsername:
        Fn::Join:
          - ""
          - - "{{resolve:secretsmanager:"
            - Ref: PostgresTestMasterUserSecretF806DC89
            - :SecretString:username::}}
      MasterUserPassword:
        Fn::Join:
          - ""
          - - "{{resolve:secretsmanager:"
            - Ref: PostgresTestMasterUserSecretF806DC89
            - :SecretString:password::}}
      ScalingConfiguration:
        AutoPause: true
        MaxCapacity: 2
        MinCapacity: 2
        SecondsUntilAutoPause: 3600
    DependsOn:
      - TestAuroraSubnetGroup
    Metadata:
      aws:cdk:path: KnexIntegrationTestStack/MysqlTestAuroraServerless
  CDKMetadata:
    Type: AWS::CDK::Metadata
    Properties:
      Analytics: v2:deflate64:H4sIAAAAAAAAE0WNu27DMAxFvyW7wlSZ2q2NDWQN7CI7TbOF8pACkkoHQf/e2kbhicThuZcevH+Dl807/uiWxuuuUBKG0hvS1XWsKQuxa1JUk0zmmq/4T6ubQoVpD+X8oOl0PjXuJOGJxn0eIs/+unUpG3/icOOVr+xDNVFACylWJ6NC+ZPaw6IdJeWHa9FwQOWeSZbK9tDcshpLdTpDvWPEbxaYPsykVhfTyHDR3dO/gt+D31w0hK3kaOHO0C3zF7cAqUEMAQAA
    Metadata:
      aws:cdk:path: KnexIntegrationTestStack/CDKMetadata/Default

