Resources:
  CodeCommitRepoDC6A41F9:
    Type: AWS::CodeCommit::Repository
    Properties:
      RepositoryName:
        Fn::Join:
          - ""
          - - Ref: AWS::StackName
            - -repo
    Metadata:
      aws:cdk:path: CdkStackJavaApp/CodeCommitRepo/Resource
  CodeCommitRepoCdkStackJavaAppCodePipeline012C859AEventRuleEDE532DD:
    Type: AWS::Events::Rule
    Properties:
      EventPattern:
        source:
          - aws.codecommit
        resources:
          - Fn::GetAtt:
              - CodeCommitRepoDC6A41F9
              - Arn
        detail-type:
          - CodeCommit Repository State Change
        detail:
          event:
            - referenceCreated
            - referenceUpdated
          referenceName:
            - master
      State: ENABLED
      Targets:
        - Arn:
            Fn::Join:
              - ""
              - - "arn:"
                - Ref: AWS::Partition
                - ":codepipeline:"
                - Ref: AWS::Region
                - ":"
                - Ref: AWS::AccountId
                - ":"
                - Ref: CodePipelineB74E5936
          Id: Target0
          RoleArn:
            Fn::GetAtt:
              - CodePipelineEventsRole4196480D
              - Arn
    Metadata:
      aws:cdk:path: CdkStackJavaApp/CodeCommitRepo/CdkStackJavaAppCodePipeline012C859AEventRule/Resource
  CdkStackJavaAppvpc0DF6A445:
    Type: AWS::EC2::VPC
    Properties:
      CidrBlock: 10.0.0.0/16
      EnableDnsHostnames: true
      EnableDnsSupport: true
      InstanceTenancy: default
      Tags:
        - Key: Name
          Value: CdkStackJavaApp/CdkStackJavaApp-vpc
    Metadata:
      aws:cdk:path: CdkStackJavaApp/CdkStackJavaApp-vpc/Resource
  CdkStackJavaAppvpcPublicSubnet1Subnet149DA61A:
    Type: AWS::EC2::Subnet
    Properties:
      CidrBlock: 10.0.0.0/17
      VpcId:
        Ref: CdkStackJavaAppvpc0DF6A445
      AvailabilityZone:
        Fn::Select:
          - 0
          - Fn::GetAZs: ""
      MapPublicIpOnLaunch: true
      Tags:
        - Key: aws-cdk:subnet-name
          Value: Public
        - Key: aws-cdk:subnet-type
          Value: Public
        - Key: Name
          Value: CdkStackJavaApp/CdkStackJavaApp-vpc/PublicSubnet1
    Metadata:
      aws:cdk:path: CdkStackJavaApp/CdkStackJavaApp-vpc/PublicSubnet1/Subnet
  CdkStackJavaAppvpcPublicSubnet1RouteTableB1DBDE15:
    Type: AWS::EC2::RouteTable
    Properties:
      VpcId:
        Ref: CdkStackJavaAppvpc0DF6A445
      Tags:
        - Key: Name
          Value: CdkStackJavaApp/CdkStackJavaApp-vpc/PublicSubnet1
    Metadata:
      aws:cdk:path: CdkStackJavaApp/CdkStackJavaApp-vpc/PublicSubnet1/RouteTable
  CdkStackJavaAppvpcPublicSubnet1RouteTableAssociation1A650B66:
    Type: AWS::EC2::SubnetRouteTableAssociation
    Properties:
      RouteTableId:
        Ref: CdkStackJavaAppvpcPublicSubnet1RouteTableB1DBDE15
      SubnetId:
        Ref: CdkStackJavaAppvpcPublicSubnet1Subnet149DA61A
    Metadata:
      aws:cdk:path: CdkStackJavaApp/CdkStackJavaApp-vpc/PublicSubnet1/RouteTableAssociation
  CdkStackJavaAppvpcPublicSubnet1DefaultRoute33A02396:
    Type: AWS::EC2::Route
    Properties:
      RouteTableId:
        Ref: CdkStackJavaAppvpcPublicSubnet1RouteTableB1DBDE15
      DestinationCidrBlock: 0.0.0.0/0
      GatewayId:
        Ref: CdkStackJavaAppvpcIGW3C50341C
    DependsOn:
      - CdkStackJavaAppvpcVPCGW6E726631
    Metadata:
      aws:cdk:path: CdkStackJavaApp/CdkStackJavaApp-vpc/PublicSubnet1/DefaultRoute
  CdkStackJavaAppvpcPublicSubnet1EIPA6E9B25A:
    Type: AWS::EC2::EIP
    Properties:
      Domain: vpc
      Tags:
        - Key: Name
          Value: CdkStackJavaApp/CdkStackJavaApp-vpc/PublicSubnet1
    Metadata:
      aws:cdk:path: CdkStackJavaApp/CdkStackJavaApp-vpc/PublicSubnet1/EIP
  CdkStackJavaAppvpcPublicSubnet1NATGateway425A4D1E:
    Type: AWS::EC2::NatGateway
    Properties:
      AllocationId:
        Fn::GetAtt:
          - CdkStackJavaAppvpcPublicSubnet1EIPA6E9B25A
          - AllocationId
      SubnetId:
        Ref: CdkStackJavaAppvpcPublicSubnet1Subnet149DA61A
      Tags:
        - Key: Name
          Value: CdkStackJavaApp/CdkStackJavaApp-vpc/PublicSubnet1
    Metadata:
      aws:cdk:path: CdkStackJavaApp/CdkStackJavaApp-vpc/PublicSubnet1/NATGateway
  CdkStackJavaAppvpcPrivateSubnet1SubnetF7A3E18C:
    Type: AWS::EC2::Subnet
    Properties:
      CidrBlock: 10.0.128.0/17
      VpcId:
        Ref: CdkStackJavaAppvpc0DF6A445
      AvailabilityZone:
        Fn::Select:
          - 0
          - Fn::GetAZs: ""
      MapPublicIpOnLaunch: false
      Tags:
        - Key: aws-cdk:subnet-name
          Value: Private
        - Key: aws-cdk:subnet-type
          Value: Private
        - Key: Name
          Value: CdkStackJavaApp/CdkStackJavaApp-vpc/PrivateSubnet1
    Metadata:
      aws:cdk:path: CdkStackJavaApp/CdkStackJavaApp-vpc/PrivateSubnet1/Subnet
  CdkStackJavaAppvpcPrivateSubnet1RouteTable0C253DCB:
    Type: AWS::EC2::RouteTable
    Properties:
      VpcId:
        Ref: CdkStackJavaAppvpc0DF6A445
      Tags:
        - Key: Name
          Value: CdkStackJavaApp/CdkStackJavaApp-vpc/PrivateSubnet1
    Metadata:
      aws:cdk:path: CdkStackJavaApp/CdkStackJavaApp-vpc/PrivateSubnet1/RouteTable
  CdkStackJavaAppvpcPrivateSubnet1RouteTableAssociation48C76663:
    Type: AWS::EC2::SubnetRouteTableAssociation
    Properties:
      RouteTableId:
        Ref: CdkStackJavaAppvpcPrivateSubnet1RouteTable0C253DCB
      SubnetId:
        Ref: CdkStackJavaAppvpcPrivateSubnet1SubnetF7A3E18C
    Metadata:
      aws:cdk:path: CdkStackJavaApp/CdkStackJavaApp-vpc/PrivateSubnet1/RouteTableAssociation
  CdkStackJavaAppvpcPrivateSubnet1DefaultRouteA616A5F0:
    Type: AWS::EC2::Route
    Properties:
      RouteTableId:
        Ref: CdkStackJavaAppvpcPrivateSubnet1RouteTable0C253DCB
      DestinationCidrBlock: 0.0.0.0/0
      NatGatewayId:
        Ref: CdkStackJavaAppvpcPublicSubnet1NATGateway425A4D1E
    Metadata:
      aws:cdk:path: CdkStackJavaApp/CdkStackJavaApp-vpc/PrivateSubnet1/DefaultRoute
  CdkStackJavaAppvpcIGW3C50341C:
    Type: AWS::EC2::InternetGateway
    Properties:
      Tags:
        - Key: Name
          Value: CdkStackJavaApp/CdkStackJavaApp-vpc
    Metadata:
      aws:cdk:path: CdkStackJavaApp/CdkStackJavaApp-vpc/IGW
  CdkStackJavaAppvpcVPCGW6E726631:
    Type: AWS::EC2::VPCGatewayAttachment
    Properties:
      VpcId:
        Ref: CdkStackJavaAppvpc0DF6A445
      InternetGatewayId:
        Ref: CdkStackJavaAppvpcIGW3C50341C
    Metadata:
      aws:cdk:path: CdkStackJavaApp/CdkStackJavaApp-vpc/VPCGW
  CdkStackJavaAppbucket3B2B7B78:
    Type: AWS::S3::Bucket
    Properties:
      VersioningConfiguration:
        Status: Enabled
    UpdateReplacePolicy: Delete
    DeletionPolicy: Delete
    Metadata:
      aws:cdk:path: CdkStackJavaApp/CdkStackJavaApp-bucket/Resource
  Role1ABCC5F0:
    Type: AWS::IAM::Role
    Properties:
      AssumeRolePolicyDocument:
        Statement:
          - Action: sts:AssumeRole
            Effect: Allow
            Principal:
              Service:
                Fn::Join:
                  - ""
                  - - ec2.
                    - Ref: AWS::URLSuffix
        Version: "2012-10-17"
      ManagedPolicyArns:
        - Fn::Join:
            - ""
            - - "arn:"
              - Ref: AWS::Partition
              - :iam::aws:policy/AmazonSSMManagedInstanceCore
        - Fn::Join:
            - ""
            - - "arn:"
              - Ref: AWS::Partition
              - :iam::aws:policy/AdministratorAccess
    Metadata:
      aws:cdk:path: CdkStackJavaApp/Role/Resource
  CodeDeployApplicationE587C27C:
    Type: AWS::CodeDeploy::Application
    Properties:
      ApplicationName: CdkStackJavaAppApplication
      ComputePlatform: Server
    Metadata:
      aws:cdk:path: CdkStackJavaApp/CodeDeployApplication/Resource
  CodeDeployDeploymentGroupRole81435E9E:
    Type: AWS::IAM::Role
    Properties:
      AssumeRolePolicyDocument:
        Statement:
          - Action: sts:AssumeRole
            Effect: Allow
            Principal:
              Service:
                Fn::Join:
                  - ""
                  - - codedeploy.
                    - Ref: AWS::Region
                    - "."
                    - Ref: AWS::URLSuffix
        Version: "2012-10-17"
      ManagedPolicyArns:
        - Fn::Join:
            - ""
            - - "arn:"
              - Ref: AWS::Partition
              - :iam::aws:policy/service-role/AWSCodeDeployRole
    Metadata:
      aws:cdk:path: CdkStackJavaApp/CodeDeployDeploymentGroup/Role/Resource
  CodeDeployDeploymentGroupA33AC6C7:
    Type: AWS::CodeDeploy::DeploymentGroup
    Properties:
      ApplicationName:
        Ref: CodeDeployApplicationE587C27C
      ServiceRoleArn:
        Fn::GetAtt:
          - CodeDeployDeploymentGroupRole81435E9E
          - Arn
      AutoRollbackConfiguration:
        Enabled: true
        Events:
          - DEPLOYMENT_FAILURE
          - DEPLOYMENT_STOP_ON_REQUEST
      DeploymentGroupName:
        Fn::Join:
          - ""
          - - Ref: AWS::StackName
            - -Group
      Ec2TagSet:
        Ec2TagSetList:
          - Ec2TagGroup:
              - Key: Name
                Type: KEY_AND_VALUE
                Value: CdkStackJavaAppInstance
    Metadata:
      aws:cdk:path: CdkStackJavaApp/CodeDeployDeploymentGroup/Resource
  CodeBuildRoleE9A44575:
    Type: AWS::IAM::Role
    Properties:
      AssumeRolePolicyDocument:
        Statement:
          - Action: sts:AssumeRole
            Effect: Allow
            Principal:
              Service: codebuild.amazonaws.com
        Version: "2012-10-17"
    Metadata:
      aws:cdk:path: CdkStackJavaApp/CodeBuild/Role/Resource
  CodeBuildRoleDefaultPolicy196BAF24:
    Type: AWS::IAM::Policy
    Properties:
      PolicyDocument:
        Statement:
          - Action: codecommit:GitPull
            Effect: Allow
            Resource:
              Fn::GetAtt:
                - CodeCommitRepoDC6A41F9
                - Arn
          - Action:
              - s3:GetObject*
              - s3:GetBucket*
              - s3:List*
              - s3:DeleteObject*
              - s3:PutObject*
              - s3:Abort*
            Effect: Allow
            Resource:
              - Fn::GetAtt:
                  - CdkStackJavaAppbucket3B2B7B78
                  - Arn
              - Fn::Join:
                  - ""
                  - - Fn::GetAtt:
                        - CdkStackJavaAppbucket3B2B7B78
                        - Arn
                    - /*
          - Action:
              - ecr:BatchCheckLayerAvailability
              - ecr:GetDownloadUrlForLayer
              - ecr:BatchGetImage
            Effect: Allow
            Resource:
              Fn::Join:
                - ""
                - - "arn:"
                  - Ref: AWS::Partition
                  - ":ecr:"
                  - Ref: AWS::Region
                  - ":"
                  - Ref: AWS::AccountId
                  - :repository/
                  - Fn::Sub: cdk-hnb659fds-container-assets-${AWS::AccountId}-${AWS::Region}
          - Action: ecr:GetAuthorizationToken
            Effect: Allow
            Resource: "*"
          - Action:
              - logs:CreateLogGroup
              - logs:CreateLogStream
              - logs:PutLogEvents
            Effect: Allow
            Resource:
              - Fn::Join:
                  - ""
                  - - "arn:"
                    - Ref: AWS::Partition
                    - ":logs:"
                    - Ref: AWS::Region
                    - ":"
                    - Ref: AWS::AccountId
                    - :log-group:/aws/codebuild/
                    - Ref: CodeBuild2FDE9E35
              - Fn::Join:
                  - ""
                  - - "arn:"
                    - Ref: AWS::Partition
                    - ":logs:"
                    - Ref: AWS::Region
                    - ":"
                    - Ref: AWS::AccountId
                    - :log-group:/aws/codebuild/
                    - Ref: CodeBuild2FDE9E35
                    - :*
          - Action:
              - codebuild:CreateReportGroup
              - codebuild:CreateReport
              - codebuild:UpdateReport
              - codebuild:BatchPutTestCases
            Effect: Allow
            Resource:
              Fn::Join:
                - ""
                - - "arn:"
                  - Ref: AWS::Partition
                  - ":codebuild:"
                  - Ref: AWS::Region
                  - ":"
                  - Ref: AWS::AccountId
                  - :report-group/
                  - Ref: CodeBuild2FDE9E35
                  - -*
          - Action: codeartifact:*
            Effect: Allow
            Resource: "*"
          - Action: sts:GetServiceBearerToken
            Effect: Allow
            Resource: "*"
          - Action:
              - s3:GetObject*
              - s3:GetBucket*
              - s3:List*
              - s3:DeleteObject*
              - s3:PutObject*
              - s3:Abort*
            Effect: Allow
            Resource:
              - Fn::GetAtt:
                  - CodePipelineArtifactsBucketF1E925CF
                  - Arn
              - Fn::Join:
                  - ""
                  - - Fn::GetAtt:
                        - CodePipelineArtifactsBucketF1E925CF
                        - Arn
                    - /*
          - Action:
              - kms:Decrypt
              - kms:DescribeKey
              - kms:Encrypt
              - kms:ReEncrypt*
              - kms:GenerateDataKey*
            Effect: Allow
            Resource:
              Fn::GetAtt:
                - CodePipelineArtifactsBucketEncryptionKey85407CB4
                - Arn
          - Action:
              - kms:Decrypt
              - kms:Encrypt
              - kms:ReEncrypt*
              - kms:GenerateDataKey*
            Effect: Allow
            Resource:
              Fn::GetAtt:
                - CodePipelineArtifactsBucketEncryptionKey85407CB4
                - Arn
        Version: "2012-10-17"
      PolicyName: CodeBuildRoleDefaultPolicy196BAF24
      Roles:
        - Ref: CodeBuildRoleE9A44575
    Metadata:
      aws:cdk:path: CdkStackJavaApp/CodeBuild/Role/DefaultPolicy/Resource
  CodeBuild2FDE9E35:
    Type: AWS::CodeBuild::Project
    Properties:
      Artifacts:
        ArtifactIdentifier: AddArtifactJarFiles
        Location:
          Ref: CdkStackJavaAppbucket3B2B7B78
        NamespaceType: NONE
        OverrideArtifactName: true
        Packaging: ZIP
        Path: target/*
        Type: S3
      Environment:
        ComputeType: BUILD_GENERAL1_SMALL
        Image:
          Fn::Sub: ${AWS::AccountId}.dkr.ecr.${AWS::Region}.${AWS::URLSuffix}/cdk-hnb659fds-container-assets-${AWS::AccountId}-${AWS::Region}:d2cb62da0695ad6f3d2861792324d6b6833e161effce4c51377e15a153376179
        ImagePullCredentialsType: SERVICE_ROLE
        PrivilegedMode: true
        Type: LINUX_CONTAINER
      ServiceRole:
        Fn::GetAtt:
          - CodeBuildRoleE9A44575
          - Arn
      Source:
        BuildSpec: |-
          {
            "version": "0.2",
            "phases": {
              "pre_build": {
                "commands": [
                  "env",
                  "export TAG=${CODEBUILD_RESOLVED_SOURCE_VERSION}",
                  "export CODEARTIFACT_AUTH_TOKEN=`aws codeartifact get-authorization-token --domain mycdkdemoapp --domain-owner 481090335964 --query authorizationToken --output text`",
                  "env"
                ]
              },
              "build": {
                "commands": [
                  "aws --version",
                  "ls -altr",
                  "mvn package -Dmaven.test.skip=true -q",
                  "mvn compile -Dmaven.test.skip=true -q",
                  "mvn -s settings.xml deploy"
                ]
              }
            },
            "artifacts": {
              "base-directory": ".",
              "files": [
                "scripts/*",
                "appspec.yml",
                "src/*"
              ]
            }
          }
        Location:
          Fn::GetAtt:
            - CodeCommitRepoDC6A41F9
            - CloneUrlHttp
        Type: CODECOMMIT
      EncryptionKey:
        Fn::GetAtt:
          - CodePipelineArtifactsBucketEncryptionKey85407CB4
          - Arn
      Name: CdkStackJavaApp
    Metadata:
      aws:cdk:path: CdkStackJavaApp/CodeBuild/Resource
  CodePipelineArtifactsBucketEncryptionKey85407CB4:
    Type: AWS::KMS::Key
    Properties:
      KeyPolicy:
        Statement:
          - Action:
              - kms:Create*
              - kms:Describe*
              - kms:Enable*
              - kms:List*
              - kms:Put*
              - kms:Update*
              - kms:Revoke*
              - kms:Disable*
              - kms:Get*
              - kms:Delete*
              - kms:ScheduleKeyDeletion
              - kms:CancelKeyDeletion
              - kms:GenerateDataKey
              - kms:TagResource
              - kms:UntagResource
            Effect: Allow
            Principal:
              AWS:
                Fn::Join:
                  - ""
                  - - "arn:"
                    - Ref: AWS::Partition
                    - ":iam::"
                    - Ref: AWS::AccountId
                    - :root
            Resource: "*"
          - Action:
              - kms:Decrypt
              - kms:DescribeKey
              - kms:Encrypt
              - kms:ReEncrypt*
              - kms:GenerateDataKey*
            Effect: Allow
            Principal:
              AWS:
                Fn::GetAtt:
                  - CodePipelineRoleB3A660B4
                  - Arn
            Resource: "*"
          - Action:
              - kms:Decrypt
              - kms:DescribeKey
              - kms:Encrypt
              - kms:ReEncrypt*
              - kms:GenerateDataKey*
            Effect: Allow
            Principal:
              AWS:
                Fn::GetAtt:
                  - CodePipelineSourceCodeCommitCodePipelineActionRoleD8DD1B70
                  - Arn
            Resource: "*"
          - Action:
              - kms:Decrypt
              - kms:DescribeKey
              - kms:Encrypt
              - kms:ReEncrypt*
              - kms:GenerateDataKey*
            Effect: Allow
            Principal:
              AWS:
                Fn::GetAtt:
                  - CodeBuildRoleE9A44575
                  - Arn
            Resource: "*"
          - Action:
              - kms:Decrypt
              - kms:Encrypt
              - kms:ReEncrypt*
              - kms:GenerateDataKey*
            Effect: Allow
            Principal:
              AWS:
                Fn::GetAtt:
                  - CodeBuildRoleE9A44575
                  - Arn
            Resource: "*"
          - Action:
              - kms:Decrypt
              - kms:DescribeKey
            Effect: Allow
            Principal:
              AWS:
                Fn::GetAtt:
                  - CodePipelineDeployCodeDeployCodePipelineActionRole8E617E3C
                  - Arn
            Resource: "*"
          - Action:
              - kms:Decrypt
              - kms:DescribeKey
            Effect: Allow
            Principal:
              AWS:
                Fn::GetAtt:
                  - Role1ABCC5F0
                  - Arn
            Resource: "*"
        Version: "2012-10-17"
    UpdateReplacePolicy: Delete
    DeletionPolicy: Delete
    Metadata:
      aws:cdk:path: CdkStackJavaApp/CodePipeline/ArtifactsBucketEncryptionKey/Resource
  CodePipelineArtifactsBucketF1E925CF:
    Type: AWS::S3::Bucket
    Properties:
      BucketEncryption:
        ServerSideEncryptionConfiguration:
          - ServerSideEncryptionByDefault:
              KMSMasterKeyID:
                Fn::GetAtt:
                  - CodePipelineArtifactsBucketEncryptionKey85407CB4
                  - Arn
              SSEAlgorithm: aws:kms
      PublicAccessBlockConfiguration:
        BlockPublicAcls: true
        BlockPublicPolicy: true
        IgnorePublicAcls: true
        RestrictPublicBuckets: true
    UpdateReplacePolicy: Retain
    DeletionPolicy: Retain
    Metadata:
      aws:cdk:path: CdkStackJavaApp/CodePipeline/ArtifactsBucket/Resource
  CodePipelineArtifactsBucketEncryptionKeyAliasA0605EC5:
    Type: AWS::KMS::Alias
    Properties:
      AliasName: alias/codepipeline-cdkstackjavaappcodepipeline012c859a
      TargetKeyId:
        Fn::GetAtt:
          - CodePipelineArtifactsBucketEncryptionKey85407CB4
          - Arn
    UpdateReplacePolicy: Delete
    DeletionPolicy: Delete
    Metadata:
      aws:cdk:path: CdkStackJavaApp/CodePipeline/ArtifactsBucketEncryptionKeyAlias/Resource
  CodePipelineRoleB3A660B4:
    Type: AWS::IAM::Role
    Properties:
      AssumeRolePolicyDocument:
        Statement:
          - Action: sts:AssumeRole
            Effect: Allow
            Principal:
              Service: codepipeline.amazonaws.com
        Version: "2012-10-17"
    Metadata:
      aws:cdk:path: CdkStackJavaApp/CodePipeline/Role/Resource
  CodePipelineRoleDefaultPolicy8D520A8D:
    Type: AWS::IAM::Policy
    Properties:
      PolicyDocument:
        Statement:
          - Action:
              - s3:GetObject*
              - s3:GetBucket*
              - s3:List*
              - s3:DeleteObject*
              - s3:PutObject*
              - s3:Abort*
            Effect: Allow
            Resource:
              - Fn::GetAtt:
                  - CodePipelineArtifactsBucketF1E925CF
                  - Arn
              - Fn::Join:
                  - ""
                  - - Fn::GetAtt:
                        - CodePipelineArtifactsBucketF1E925CF
                        - Arn
                    - /*
          - Action:
              - kms:Decrypt
              - kms:DescribeKey
              - kms:Encrypt
              - kms:ReEncrypt*
              - kms:GenerateDataKey*
            Effect: Allow
            Resource:
              Fn::GetAtt:
                - CodePipelineArtifactsBucketEncryptionKey85407CB4
                - Arn
          - Action: sts:AssumeRole
            Effect: Allow
            Resource:
              Fn::GetAtt:
                - CodePipelineSourceCodeCommitCodePipelineActionRoleD8DD1B70
                - Arn
          - Action: sts:AssumeRole
            Effect: Allow
            Resource:
              Fn::GetAtt:
                - CodePipelineBuildCodeBuildCodePipelineActionRoleD4AF8729
                - Arn
          - Action: sts:AssumeRole
            Effect: Allow
            Resource:
              Fn::GetAtt:
                - CodePipelineDeployCodeDeployCodePipelineActionRole8E617E3C
                - Arn
        Version: "2012-10-17"
      PolicyName: CodePipelineRoleDefaultPolicy8D520A8D
      Roles:
        - Ref: CodePipelineRoleB3A660B4
    Metadata:
      aws:cdk:path: CdkStackJavaApp/CodePipeline/Role/DefaultPolicy/Resource
  CodePipelineB74E5936:
    Type: AWS::CodePipeline::Pipeline
    Properties:
      RoleArn:
        Fn::GetAtt:
          - CodePipelineRoleB3A660B4
          - Arn
      Stages:
        - Actions:
            - ActionTypeId:
                Category: Source
                Owner: AWS
                Provider: CodeCommit
                Version: "1"
              Configuration:
                RepositoryName:
                  Fn::GetAtt:
                    - CodeCommitRepoDC6A41F9
                    - Name
                BranchName: master
                PollForSourceChanges: false
              Name: CodeCommit
              OutputArtifacts:
                - Name: Artifact_Source_CodeCommit
              RoleArn:
                Fn::GetAtt:
                  - CodePipelineSourceCodeCommitCodePipelineActionRoleD8DD1B70
                  - Arn
              RunOrder: 1
          Name: Source
        - Actions:
            - ActionTypeId:
                Category: Build
                Owner: AWS
                Provider: CodeBuild
                Version: "1"
              Configuration:
                ProjectName:
                  Ref: CodeBuild2FDE9E35
              InputArtifacts:
                - Name: Artifact_Source_CodeCommit
              Name: CodeBuild
              OutputArtifacts:
                - Name: Artifact_Build_CodeBuild
              RoleArn:
                Fn::GetAtt:
                  - CodePipelineBuildCodeBuildCodePipelineActionRoleD4AF8729
                  - Arn
              RunOrder: 1
          Name: Build
        - Actions:
            - ActionTypeId:
                Category: Deploy
                Owner: AWS
                Provider: CodeDeploy
                Version: "1"
              Configuration:
                ApplicationName:
                  Ref: CodeDeployApplicationE587C27C
                DeploymentGroupName:
                  Ref: CodeDeployDeploymentGroupA33AC6C7
              InputArtifacts:
                - Name: Artifact_Build_CodeBuild
              Name: CodeDeploy
              RoleArn:
                Fn::GetAtt:
                  - CodePipelineDeployCodeDeployCodePipelineActionRole8E617E3C
                  - Arn
              RunOrder: 1
          Name: Deploy
      ArtifactStore:
        EncryptionKey:
          Id:
            Fn::GetAtt:
              - CodePipelineArtifactsBucketEncryptionKey85407CB4
              - Arn
          Type: KMS
        Location:
          Ref: CodePipelineArtifactsBucketF1E925CF
        Type: S3
    DependsOn:
      - CodePipelineRoleDefaultPolicy8D520A8D
      - CodePipelineRoleB3A660B4
    Metadata:
      aws:cdk:path: CdkStackJavaApp/CodePipeline/Resource
  CodePipelineSourceCodeCommitCodePipelineActionRoleD8DD1B70:
    Type: AWS::IAM::Role
    Properties:
      AssumeRolePolicyDocument:
        Statement:
          - Action: sts:AssumeRole
            Effect: Allow
            Principal:
              AWS:
                Fn::Join:
                  - ""
                  - - "arn:"
                    - Ref: AWS::Partition
                    - ":iam::"
                    - Ref: AWS::AccountId
                    - :root
        Version: "2012-10-17"
    Metadata:
      aws:cdk:path: CdkStackJavaApp/CodePipeline/Source/CodeCommit/CodePipelineActionRole/Resource
  CodePipelineSourceCodeCommitCodePipelineActionRoleDefaultPolicyAFBD34E4:
    Type: AWS::IAM::Policy
    Properties:
      PolicyDocument:
        Statement:
          - Action:
              - s3:GetObject*
              - s3:GetBucket*
              - s3:List*
              - s3:DeleteObject*
              - s3:PutObject*
              - s3:Abort*
            Effect: Allow
            Resource:
              - Fn::GetAtt:
                  - CodePipelineArtifactsBucketF1E925CF
                  - Arn
              - Fn::Join:
                  - ""
                  - - Fn::GetAtt:
                        - CodePipelineArtifactsBucketF1E925CF
                        - Arn
                    - /*
          - Action:
              - kms:Decrypt
              - kms:DescribeKey
              - kms:Encrypt
              - kms:ReEncrypt*
              - kms:GenerateDataKey*
            Effect: Allow
            Resource:
              Fn::GetAtt:
                - CodePipelineArtifactsBucketEncryptionKey85407CB4
                - Arn
          - Action:
              - codecommit:GetBranch
              - codecommit:GetCommit
              - codecommit:UploadArchive
              - codecommit:GetUploadArchiveStatus
              - codecommit:CancelUploadArchive
            Effect: Allow
            Resource:
              Fn::GetAtt:
                - CodeCommitRepoDC6A41F9
                - Arn
        Version: "2012-10-17"
      PolicyName: CodePipelineSourceCodeCommitCodePipelineActionRoleDefaultPolicyAFBD34E4
      Roles:
        - Ref: CodePipelineSourceCodeCommitCodePipelineActionRoleD8DD1B70
    Metadata:
      aws:cdk:path: CdkStackJavaApp/CodePipeline/Source/CodeCommit/CodePipelineActionRole/DefaultPolicy/Resource
  CodePipelineEventsRole4196480D:
    Type: AWS::IAM::Role
    Properties:
      AssumeRolePolicyDocument:
        Statement:
          - Action: sts:AssumeRole
            Effect: Allow
            Principal:
              Service: events.amazonaws.com
        Version: "2012-10-17"
    Metadata:
      aws:cdk:path: CdkStackJavaApp/CodePipeline/EventsRole/Resource
  CodePipelineEventsRoleDefaultPolicy13DBD2D2:
    Type: AWS::IAM::Policy
    Properties:
      PolicyDocument:
        Statement:
          - Action: codepipeline:StartPipelineExecution
            Effect: Allow
            Resource:
              Fn::Join:
                - ""
                - - "arn:"
                  - Ref: AWS::Partition
                  - ":codepipeline:"
                  - Ref: AWS::Region
                  - ":"
                  - Ref: AWS::AccountId
                  - ":"
                  - Ref: CodePipelineB74E5936
        Version: "2012-10-17"
      PolicyName: CodePipelineEventsRoleDefaultPolicy13DBD2D2
      Roles:
        - Ref: CodePipelineEventsRole4196480D
    Metadata:
      aws:cdk:path: CdkStackJavaApp/CodePipeline/EventsRole/DefaultPolicy/Resource
  CodePipelineBuildCodeBuildCodePipelineActionRoleD4AF8729:
    Type: AWS::IAM::Role
    Properties:
      AssumeRolePolicyDocument:
        Statement:
          - Action: sts:AssumeRole
            Effect: Allow
            Principal:
              AWS:
                Fn::Join:
                  - ""
                  - - "arn:"
                    - Ref: AWS::Partition
                    - ":iam::"
                    - Ref: AWS::AccountId
                    - :root
        Version: "2012-10-17"
    Metadata:
      aws:cdk:path: CdkStackJavaApp/CodePipeline/Build/CodeBuild/CodePipelineActionRole/Resource
  CodePipelineBuildCodeBuildCodePipelineActionRoleDefaultPolicyED0B3DB6:
    Type: AWS::IAM::Policy
    Properties:
      PolicyDocument:
        Statement:
          - Action:
              - codebuild:BatchGetBuilds
              - codebuild:StartBuild
              - codebuild:StopBuild
            Effect: Allow
            Resource:
              Fn::GetAtt:
                - CodeBuild2FDE9E35
                - Arn
        Version: "2012-10-17"
      PolicyName: CodePipelineBuildCodeBuildCodePipelineActionRoleDefaultPolicyED0B3DB6
      Roles:
        - Ref: CodePipelineBuildCodeBuildCodePipelineActionRoleD4AF8729
    Metadata:
      aws:cdk:path: CdkStackJavaApp/CodePipeline/Build/CodeBuild/CodePipelineActionRole/DefaultPolicy/Resource
  CodePipelineDeployCodeDeployCodePipelineActionRole8E617E3C:
    Type: AWS::IAM::Role
    Properties:
      AssumeRolePolicyDocument:
        Statement:
          - Action: sts:AssumeRole
            Effect: Allow
            Principal:
              AWS:
                Fn::Join:
                  - ""
                  - - "arn:"
                    - Ref: AWS::Partition
                    - ":iam::"
                    - Ref: AWS::AccountId
                    - :root
        Version: "2012-10-17"
    Metadata:
      aws:cdk:path: CdkStackJavaApp/CodePipeline/Deploy/CodeDeploy/CodePipelineActionRole/Resource
  CodePipelineDeployCodeDeployCodePipelineActionRoleDefaultPolicyFD5A6851:
    Type: AWS::IAM::Policy
    Properties:
      PolicyDocument:
        Statement:
          - Action:
              - codedeploy:GetApplicationRevision
              - codedeploy:RegisterApplicationRevision
            Effect: Allow
            Resource:
              Fn::Join:
                - ""
                - - "arn:"
                  - Ref: AWS::Partition
                  - ":codedeploy:"
                  - Ref: AWS::Region
                  - ":"
                  - Ref: AWS::AccountId
                  - ":application:"
                  - Ref: CodeDeployApplicationE587C27C
          - Action:
              - codedeploy:CreateDeployment
              - codedeploy:GetDeployment
            Effect: Allow
            Resource:
              Fn::Join:
                - ""
                - - "arn:"
                  - Ref: AWS::Partition
                  - ":codedeploy:"
                  - Ref: AWS::Region
                  - ":"
                  - Ref: AWS::AccountId
                  - ":deploymentgroup:"
                  - Ref: CodeDeployApplicationE587C27C
                  - /
                  - Ref: CodeDeployDeploymentGroupA33AC6C7
          - Action: codedeploy:GetDeploymentConfig
            Effect: Allow
            Resource:
              Fn::Join:
                - ""
                - - "arn:"
                  - Ref: AWS::Partition
                  - ":codedeploy:"
                  - Ref: AWS::Region
                  - ":"
                  - Ref: AWS::AccountId
                  - :deploymentconfig:CodeDeployDefault.OneAtATime
          - Action:
              - s3:GetObject*
              - s3:GetBucket*
              - s3:List*
            Effect: Allow
            Resource:
              - Fn::GetAtt:
                  - CodePipelineArtifactsBucketF1E925CF
                  - Arn
              - Fn::Join:
                  - ""
                  - - Fn::GetAtt:
                        - CodePipelineArtifactsBucketF1E925CF
                        - Arn
                    - /*
          - Action:
              - kms:Decrypt
              - kms:DescribeKey
            Effect: Allow
            Resource:
              Fn::GetAtt:
                - CodePipelineArtifactsBucketEncryptionKey85407CB4
                - Arn
        Version: "2012-10-17"
      PolicyName: CodePipelineDeployCodeDeployCodePipelineActionRoleDefaultPolicyFD5A6851
      Roles:
        - Ref: CodePipelineDeployCodeDeployCodePipelineActionRole8E617E3C
    Metadata:
      aws:cdk:path: CdkStackJavaApp/CodePipeline/Deploy/CodeDeploy/CodePipelineActionRole/DefaultPolicy/Resource
  InstanceInstanceSecurityGroupF0E2D5BE:
    Type: AWS::EC2::SecurityGroup
    Properties:
      GroupDescription: CdkStackJavaApp/Instance/InstanceSecurityGroup
      SecurityGroupEgress:
        - CidrIp: 0.0.0.0/0
          Description: Allow all outbound traffic by default
          IpProtocol: "-1"
      Tags:
        - Key: Name
          Value: CdkStackJavaAppInstance
      VpcId:
        Ref: CdkStackJavaAppvpc0DF6A445
    Metadata:
      aws:cdk:path: CdkStackJavaApp/Instance/InstanceSecurityGroup/Resource
  InstanceInstanceProfileAB5AEF02:
    Type: AWS::IAM::InstanceProfile
    Properties:
      Roles:
        - Ref: Role1ABCC5F0
    Metadata:
      aws:cdk:path: CdkStackJavaApp/Instance/InstanceProfile
  InstanceC1063A87:
    Type: AWS::EC2::Instance
    Properties:
      AvailabilityZone:
        Fn::Select:
          - 0
          - Fn::GetAZs: ""
      IamInstanceProfile:
        Ref: InstanceInstanceProfileAB5AEF02
      ImageId:
        Ref: SsmParameterValueawsserviceamiamazonlinuxlatestamzn2amihvmx8664gp2C96584B6F00A464EAD1953AFF4B05118Parameter
      InstanceType: c5n.large
      SecurityGroupIds:
        - Fn::GetAtt:
            - InstanceInstanceSecurityGroupF0E2D5BE
            - GroupId
      SubnetId:
        Ref: CdkStackJavaAppvpcPublicSubnet1Subnet149DA61A
      Tags:
        - Key: Name
          Value: CdkStackJavaAppInstance
      UserData:
        Fn::Base64:
          Fn::Join:
            - ""
            - - |-
                #!/bin/bash
                exec > >(tee /var/log/user-data.log|logger -t user-data -s 2>/dev/console) 2>&1
                yum install -y tmux jq java-11-amazon-corretto-headless ruby
                cd /home/ec2-user
                wget https://d1osg35nybn3tt.cloudfront.net/com/amazonaws/codeguru-profiler-java-agent-standalone/1.0.0/codeguru-profiler-java-agent-standalone-1.0.0.jar
                yum install -y aws-cli
                cd /tmp
                wget https://aws-codedeploy-
              - Ref: AWS::Region
              - |-
                .s3.amazonaws.com/latest/codedeploy-agent.noarch.rpm -P /tmp
                sudo yum -y install /tmp/codedeploy-agent.noarch.rpm
                sudo service codedeploy-agent status
                /opt/aws/bin/cfn-signal -e $? --stack 
              - Ref: AWS::StackName
              - " --resource InstanceC1063A87 --region "
              - Ref: AWS::Region
    DependsOn:
      - Role1ABCC5F0
    CreationPolicy:
      ResourceSignal:
        Timeout: PT10M
    Metadata:
      aws:cdk:path: CdkStackJavaApp/Instance/Resource
  SQSqueueE5BF4E7F:
    Type: AWS::SQS::Queue
    Metadata:
      aws:cdk:path: CdkStackJavaApp/SQS_queue/Resource
  CDKMetadata:
    Type: AWS::CDK::Metadata
    Properties:
      Modules: aws-cdk=2.113.0,@aws-cdk/assets=1.58.0,@aws-cdk/aws-applicationautoscaling=1.58.0,@aws-cdk/aws-autoscaling=1.58.0,@aws-cdk/aws-autoscaling-common=1.58.0,@aws-cdk/aws-autoscaling-hooktargets=1.58.0,@aws-cdk/aws-cloudformation=1.58.0,@aws-cdk/aws-cloudwatch=1.58.0,@aws-cdk/aws-codebuild=1.58.0,@aws-cdk/aws-codecommit=1.58.0,@aws-cdk/aws-codedeploy=1.58.0,@aws-cdk/aws-codeguruprofiler=1.58.0,@aws-cdk/aws-codepipeline=1.58.0,@aws-cdk/aws-codepipeline-actions=1.58.0,@aws-cdk/aws-ec2=1.58.0,@aws-cdk/aws-ecr=1.58.0,@aws-cdk/aws-ecr-assets=1.58.0,@aws-cdk/aws-ecs=1.58.0,@aws-cdk/aws-elasticloadbalancingv2=1.58.0,@aws-cdk/aws-events=1.58.0,@aws-cdk/aws-events-targets=1.58.0,@aws-cdk/aws-iam=1.58.0,@aws-cdk/aws-kms=1.58.0,@aws-cdk/aws-lambda=1.58.0,@aws-cdk/aws-logs=1.58.0,@aws-cdk/aws-s3=1.58.0,@aws-cdk/aws-s3-assets=1.58.0,@aws-cdk/aws-servicediscovery=1.58.0,@aws-cdk/aws-sns=1.58.0,@aws-cdk/aws-sns-subscriptions=1.58.0,@aws-cdk/aws-sqs=1.58.0,@aws-cdk/aws-ssm=1.58.0,@aws-cdk/cloud-assembly-schema=1.58.0,@aws-cdk/core=1.58.0,@aws-cdk/custom-resources=1.58.0,@aws-cdk/cx-api=1.58.0,@aws-cdk/region-info=1.58.0,jsii-runtime=node.js/v18.12.1
    Condition: CDKMetadataAvailable
Parameters:
  SsmParameterValueawsserviceamiamazonlinuxlatestamzn2amihvmx8664gp2C96584B6F00A464EAD1953AFF4B05118Parameter:
    Type: AWS::SSM::Parameter::Value<AWS::EC2::Image::Id>
    Default: /aws/service/ami-amazon-linux-latest/amzn2-ami-hvm-x86_64-gp2
Conditions:
  CDKMetadataAvailable:
    Fn::Or:
      - Fn::Or:
          - Fn::Equals:
              - Ref: AWS::Region
              - af-south-1
          - Fn::Equals:
              - Ref: AWS::Region
              - ap-east-1
          - Fn::Equals:
              - Ref: AWS::Region
              - ap-northeast-1
          - Fn::Equals:
              - Ref: AWS::Region
              - ap-northeast-2
          - Fn::Equals:
              - Ref: AWS::Region
              - ap-south-1
          - Fn::Equals:
              - Ref: AWS::Region
              - ap-southeast-1
          - Fn::Equals:
              - Ref: AWS::Region
              - ap-southeast-2
          - Fn::Equals:
              - Ref: AWS::Region
              - ca-central-1
          - Fn::Equals:
              - Ref: AWS::Region
              - cn-north-1
          - Fn::Equals:
              - Ref: AWS::Region
              - cn-northwest-1
      - Fn::Or:
          - Fn::Equals:
              - Ref: AWS::Region
              - eu-central-1
          - Fn::Equals:
              - Ref: AWS::Region
              - eu-north-1
          - Fn::Equals:
              - Ref: AWS::Region
              - eu-south-1
          - Fn::Equals:
              - Ref: AWS::Region
              - eu-west-1
          - Fn::Equals:
              - Ref: AWS::Region
              - eu-west-2
          - Fn::Equals:
              - Ref: AWS::Region
              - eu-west-3
          - Fn::Equals:
              - Ref: AWS::Region
              - il-central-1
          - Fn::Equals:
              - Ref: AWS::Region
              - me-central-1
          - Fn::Equals:
              - Ref: AWS::Region
              - me-south-1
          - Fn::Equals:
              - Ref: AWS::Region
              - sa-east-1
      - Fn::Or:
          - Fn::Equals:
              - Ref: AWS::Region
              - us-east-1
          - Fn::Equals:
              - Ref: AWS::Region
              - us-east-2
          - Fn::Equals:
              - Ref: AWS::Region
              - us-west-1
          - Fn::Equals:
              - Ref: AWS::Region
              - us-west-2

