Resources:
  elasticachedemovpc9EEF29B7:
    Type: AWS::EC2::VPC
    Properties:
      CidrBlock: 10.0.0.0/16
      EnableDnsHostnames: true
      EnableDnsSupport: true
      InstanceTenancy: default
      Tags:
        - Key: Name
          Value: RedisSecretRotationDemo/elasticache-demo-vpc
    Metadata:
      aws:cdk:path: RedisSecretRotationDemo/elasticache-demo-vpc/Resource
  elasticachedemovpcPrivateSubnet1SubnetE60FDB9E:
    Type: AWS::EC2::Subnet
    Properties:
      VpcId:
        Ref: elasticachedemovpc9EEF29B7
      AvailabilityZone:
        Fn::Select:
          - 0
          - Fn::GetAZs: ""
      CidrBlock: 10.0.0.0/24
      MapPublicIpOnLaunch: false
      Tags:
        - Key: aws-cdk:subnet-name
          Value: Private
        - Key: aws-cdk:subnet-type
          Value: Private
        - Key: Name
          Value: RedisSecretRotationDemo/elasticache-demo-vpc/PrivateSubnet1
    Metadata:
      aws:cdk:path: RedisSecretRotationDemo/elasticache-demo-vpc/PrivateSubnet1/Subnet
  elasticachedemovpcPrivateSubnet1RouteTable76CF92D5:
    Type: AWS::EC2::RouteTable
    Properties:
      VpcId:
        Ref: elasticachedemovpc9EEF29B7
      Tags:
        - Key: Name
          Value: RedisSecretRotationDemo/elasticache-demo-vpc/PrivateSubnet1
    Metadata:
      aws:cdk:path: RedisSecretRotationDemo/elasticache-demo-vpc/PrivateSubnet1/RouteTable
  elasticachedemovpcPrivateSubnet1RouteTableAssociationBD62AA3D:
    Type: AWS::EC2::SubnetRouteTableAssociation
    Properties:
      RouteTableId:
        Ref: elasticachedemovpcPrivateSubnet1RouteTable76CF92D5
      SubnetId:
        Ref: elasticachedemovpcPrivateSubnet1SubnetE60FDB9E
    Metadata:
      aws:cdk:path: RedisSecretRotationDemo/elasticache-demo-vpc/PrivateSubnet1/RouteTableAssociation
  elasticachedemovpcPrivateSubnet1DefaultRouteDA9519AA:
    Type: AWS::EC2::Route
    Properties:
      RouteTableId:
        Ref: elasticachedemovpcPrivateSubnet1RouteTable76CF92D5
      DestinationCidrBlock: 0.0.0.0/0
      NatGatewayId:
        Ref: elasticachedemovpcPublicSubnet1NATGateway092A3D52
    Metadata:
      aws:cdk:path: RedisSecretRotationDemo/elasticache-demo-vpc/PrivateSubnet1/DefaultRoute
  elasticachedemovpcPrivateSubnet2SubnetB2DC7386:
    Type: AWS::EC2::Subnet
    Properties:
      VpcId:
        Ref: elasticachedemovpc9EEF29B7
      AvailabilityZone:
        Fn::Select:
          - 1
          - Fn::GetAZs: ""
      CidrBlock: 10.0.1.0/24
      MapPublicIpOnLaunch: false
      Tags:
        - Key: aws-cdk:subnet-name
          Value: Private
        - Key: aws-cdk:subnet-type
          Value: Private
        - Key: Name
          Value: RedisSecretRotationDemo/elasticache-demo-vpc/PrivateSubnet2
    Metadata:
      aws:cdk:path: RedisSecretRotationDemo/elasticache-demo-vpc/PrivateSubnet2/Subnet
  elasticachedemovpcPrivateSubnet2RouteTableE90EB37E:
    Type: AWS::EC2::RouteTable
    Properties:
      VpcId:
        Ref: elasticachedemovpc9EEF29B7
      Tags:
        - Key: Name
          Value: RedisSecretRotationDemo/elasticache-demo-vpc/PrivateSubnet2
    Metadata:
      aws:cdk:path: RedisSecretRotationDemo/elasticache-demo-vpc/PrivateSubnet2/RouteTable
  elasticachedemovpcPrivateSubnet2RouteTableAssociationDCDB2982:
    Type: AWS::EC2::SubnetRouteTableAssociation
    Properties:
      RouteTableId:
        Ref: elasticachedemovpcPrivateSubnet2RouteTableE90EB37E
      SubnetId:
        Ref: elasticachedemovpcPrivateSubnet2SubnetB2DC7386
    Metadata:
      aws:cdk:path: RedisSecretRotationDemo/elasticache-demo-vpc/PrivateSubnet2/RouteTableAssociation
  elasticachedemovpcPrivateSubnet2DefaultRouteEC61918F:
    Type: AWS::EC2::Route
    Properties:
      RouteTableId:
        Ref: elasticachedemovpcPrivateSubnet2RouteTableE90EB37E
      DestinationCidrBlock: 0.0.0.0/0
      NatGatewayId:
        Ref: elasticachedemovpcPublicSubnet2NATGateway229D2CEB
    Metadata:
      aws:cdk:path: RedisSecretRotationDemo/elasticache-demo-vpc/PrivateSubnet2/DefaultRoute
  elasticachedemovpcPublicSubnet1Subnet6D468D4B:
    Type: AWS::EC2::Subnet
    Properties:
      VpcId:
        Ref: elasticachedemovpc9EEF29B7
      AvailabilityZone:
        Fn::Select:
          - 0
          - Fn::GetAZs: ""
      CidrBlock: 10.0.2.0/24
      MapPublicIpOnLaunch: true
      Tags:
        - Key: aws-cdk:subnet-name
          Value: Public
        - Key: aws-cdk:subnet-type
          Value: Public
        - Key: Name
          Value: RedisSecretRotationDemo/elasticache-demo-vpc/PublicSubnet1
    Metadata:
      aws:cdk:path: RedisSecretRotationDemo/elasticache-demo-vpc/PublicSubnet1/Subnet
  elasticachedemovpcPublicSubnet1RouteTable881099C5:
    Type: AWS::EC2::RouteTable
    Properties:
      VpcId:
        Ref: elasticachedemovpc9EEF29B7
      Tags:
        - Key: Name
          Value: RedisSecretRotationDemo/elasticache-demo-vpc/PublicSubnet1
    Metadata:
      aws:cdk:path: RedisSecretRotationDemo/elasticache-demo-vpc/PublicSubnet1/RouteTable
  elasticachedemovpcPublicSubnet1RouteTableAssociation642BA55F:
    Type: AWS::EC2::SubnetRouteTableAssociation
    Properties:
      RouteTableId:
        Ref: elasticachedemovpcPublicSubnet1RouteTable881099C5
      SubnetId:
        Ref: elasticachedemovpcPublicSubnet1Subnet6D468D4B
    Metadata:
      aws:cdk:path: RedisSecretRotationDemo/elasticache-demo-vpc/PublicSubnet1/RouteTableAssociation
  elasticachedemovpcPublicSubnet1DefaultRoute4434C510:
    Type: AWS::EC2::Route
    Properties:
      RouteTableId:
        Ref: elasticachedemovpcPublicSubnet1RouteTable881099C5
      DestinationCidrBlock: 0.0.0.0/0
      GatewayId:
        Ref: elasticachedemovpcIGWB2D9A7B9
    DependsOn:
      - elasticachedemovpcVPCGWA922A7FA
    Metadata:
      aws:cdk:path: RedisSecretRotationDemo/elasticache-demo-vpc/PublicSubnet1/DefaultRoute
  elasticachedemovpcPublicSubnet1EIP5C0EAFC9:
    Type: AWS::EC2::EIP
    Properties:
      Domain: vpc
      Tags:
        - Key: Name
          Value: RedisSecretRotationDemo/elasticache-demo-vpc/PublicSubnet1
    Metadata:
      aws:cdk:path: RedisSecretRotationDemo/elasticache-demo-vpc/PublicSubnet1/EIP
  elasticachedemovpcPublicSubnet1NATGateway092A3D52:
    Type: AWS::EC2::NatGateway
    Properties:
      SubnetId:
        Ref: elasticachedemovpcPublicSubnet1Subnet6D468D4B
      AllocationId:
        Fn::GetAtt:
          - elasticachedemovpcPublicSubnet1EIP5C0EAFC9
          - AllocationId
      Tags:
        - Key: Name
          Value: RedisSecretRotationDemo/elasticache-demo-vpc/PublicSubnet1
    Metadata:
      aws:cdk:path: RedisSecretRotationDemo/elasticache-demo-vpc/PublicSubnet1/NATGateway
  elasticachedemovpcPublicSubnet2SubnetF31209E6:
    Type: AWS::EC2::Subnet
    Properties:
      VpcId:
        Ref: elasticachedemovpc9EEF29B7
      AvailabilityZone:
        Fn::Select:
          - 1
          - Fn::GetAZs: ""
      CidrBlock: 10.0.3.0/24
      MapPublicIpOnLaunch: true
      Tags:
        - Key: aws-cdk:subnet-name
          Value: Public
        - Key: aws-cdk:subnet-type
          Value: Public
        - Key: Name
          Value: RedisSecretRotationDemo/elasticache-demo-vpc/PublicSubnet2
    Metadata:
      aws:cdk:path: RedisSecretRotationDemo/elasticache-demo-vpc/PublicSubnet2/Subnet
  elasticachedemovpcPublicSubnet2RouteTableEE1F746A:
    Type: AWS::EC2::RouteTable
    Properties:
      VpcId:
        Ref: elasticachedemovpc9EEF29B7
      Tags:
        - Key: Name
          Value: RedisSecretRotationDemo/elasticache-demo-vpc/PublicSubnet2
    Metadata:
      aws:cdk:path: RedisSecretRotationDemo/elasticache-demo-vpc/PublicSubnet2/RouteTable
  elasticachedemovpcPublicSubnet2RouteTableAssociationE703F9FB:
    Type: AWS::EC2::SubnetRouteTableAssociation
    Properties:
      RouteTableId:
        Ref: elasticachedemovpcPublicSubnet2RouteTableEE1F746A
      SubnetId:
        Ref: elasticachedemovpcPublicSubnet2SubnetF31209E6
    Metadata:
      aws:cdk:path: RedisSecretRotationDemo/elasticache-demo-vpc/PublicSubnet2/RouteTableAssociation
  elasticachedemovpcPublicSubnet2DefaultRoute66ADBDEF:
    Type: AWS::EC2::Route
    Properties:
      RouteTableId:
        Ref: elasticachedemovpcPublicSubnet2RouteTableEE1F746A
      DestinationCidrBlock: 0.0.0.0/0
      GatewayId:
        Ref: elasticachedemovpcIGWB2D9A7B9
    DependsOn:
      - elasticachedemovpcVPCGWA922A7FA
    Metadata:
      aws:cdk:path: RedisSecretRotationDemo/elasticache-demo-vpc/PublicSubnet2/DefaultRoute
  elasticachedemovpcPublicSubnet2EIP4CF0D987:
    Type: AWS::EC2::EIP
    Properties:
      Domain: vpc
      Tags:
        - Key: Name
          Value: RedisSecretRotationDemo/elasticache-demo-vpc/PublicSubnet2
    Metadata:
      aws:cdk:path: RedisSecretRotationDemo/elasticache-demo-vpc/PublicSubnet2/EIP
  elasticachedemovpcPublicSubnet2NATGateway229D2CEB:
    Type: AWS::EC2::NatGateway
    Properties:
      SubnetId:
        Ref: elasticachedemovpcPublicSubnet2SubnetF31209E6
      AllocationId:
        Fn::GetAtt:
          - elasticachedemovpcPublicSubnet2EIP4CF0D987
          - AllocationId
      Tags:
        - Key: Name
          Value: RedisSecretRotationDemo/elasticache-demo-vpc/PublicSubnet2
    Metadata:
      aws:cdk:path: RedisSecretRotationDemo/elasticache-demo-vpc/PublicSubnet2/NATGateway
  elasticachedemovpcIGWB2D9A7B9:
    Type: AWS::EC2::InternetGateway
    Properties:
      Tags:
        - Key: Name
          Value: RedisSecretRotationDemo/elasticache-demo-vpc
    Metadata:
      aws:cdk:path: RedisSecretRotationDemo/elasticache-demo-vpc/IGW
  elasticachedemovpcVPCGWA922A7FA:
    Type: AWS::EC2::VPCGatewayAttachment
    Properties:
      VpcId:
        Ref: elasticachedemovpc9EEF29B7
      InternetGatewayId:
        Ref: elasticachedemovpcIGWB2D9A7B9
    Metadata:
      aws:cdk:path: RedisSecretRotationDemo/elasticache-demo-vpc/VPCGW
  ElastiCacheSG1EAF1356:
    Type: AWS::EC2::SecurityGroup
    Properties:
      GroupDescription: SecurityGroup associated with the ElastiCache Redis Cluster
      SecurityGroupEgress:
        - CidrIp: 0.0.0.0/0
          Description: Allow all outbound traffic by default
          IpProtocol: "-1"
      SecurityGroupIngress:
        - CidrIp: 0.0.0.0/0
          Description: Redis ingress 6379
          FromPort: 6379
          IpProtocol: tcp
          ToPort: 6379
      VpcId:
        Ref: elasticachedemovpc9EEF29B7
    Metadata:
      aws:cdk:path: RedisSecretRotationDemo/ElastiCacheSG/Resource
  RotatorSGF4319483:
    Type: AWS::EC2::SecurityGroup
    Properties:
      GroupDescription: SecurityGroup for rotator function
      SecurityGroupEgress:
        - CidrIp: 0.0.0.0/0
          Description: Allow all outbound traffic by default
          IpProtocol: "-1"
      SecurityGroupIngress:
        - CidrIp: 0.0.0.0/0
          Description: All port inbound
          IpProtocol: "-1"
      VpcId:
        Ref: elasticachedemovpc9EEF29B7
    Metadata:
      aws:cdk:path: RedisSecretRotationDemo/RotatorSG/Resource
  ElastiCacheSubnetGroup:
    Type: AWS::ElastiCache::SubnetGroup
    Properties:
      Description: Elasticache Subnet Group
      SubnetIds:
        - Ref: elasticachedemovpcPrivateSubnet1SubnetE60FDB9E
        - Ref: elasticachedemovpcPrivateSubnet2SubnetB2DC7386
    Metadata:
      aws:cdk:path: RedisSecretRotationDemo/ElastiCacheSubnetGroup
  SingleAuthRedisAuth48A2B3DE:
    Type: AWS::SecretsManager::Secret
    Properties:
      GenerateSecretString:
        ExcludeCharacters: "@%*()_+=`~{}|[]\\:\";'?,./"
        GenerateStringKey: authToken
        SecretStringTemplate: '{"replicationGroupId":"redisSingleAuthDemo"}'
    UpdateReplacePolicy: Delete
    DeletionPolicy: Delete
    Metadata:
      aws:cdk:path: RedisSecretRotationDemo/SingleAuth/RedisAuth/Resource
  SingleAuthRedisAuthRotationSchedule1ECD889C:
    Type: AWS::SecretsManager::RotationSchedule
    Properties:
      SecretId:
        Ref: SingleAuthRedisAuth48A2B3DE
      RotationLambdaARN:
        Fn::GetAtt:
          - SingleAuthfunction116FEAF0
          - Arn
      RotationRules:
        AutomaticallyAfterDays: 15
    Metadata:
      aws:cdk:path: RedisSecretRotationDemo/SingleAuth/RedisAuth/RotationSchedule/Resource
  SingleAuthRedisAuthPolicy1F0AED24:
    Type: AWS::SecretsManager::ResourcePolicy
    Properties:
      ResourcePolicy:
        Statement:
          - Action: secretsmanager:DeleteSecret
            Effect: Deny
            Principal:
              AWS:
                Fn::Join:
                  - ""
                  - - "arn:"
                    - Ref: AWS::Partition
                    - ":iam::"
                    - Ref: AWS::AccountId
                    - :root
            Resource: "*"
        Version: "2012-10-17"
      SecretId:
        Ref: SingleAuthRedisAuth48A2B3DE
    Metadata:
      aws:cdk:path: RedisSecretRotationDemo/SingleAuth/RedisAuth/Policy/Resource
  SingleAuthRedisReplicationGroupAEBB5A46:
    Type: AWS::ElastiCache::ReplicationGroup
    Properties:
      ReplicationGroupDescription: RedisReplicationGroup-RBAC-Demo
      AtRestEncryptionEnabled: true
      AuthToken:
        Fn::Join:
          - ""
          - - "{{resolve:secretsmanager:"
            - Ref: SingleAuthRedisAuth48A2B3DE
            - :SecretString:authToken::}}
      CacheNodeType: cache.m4.large
      CacheSubnetGroupName:
        Ref: ElastiCacheSubnetGroup
      Engine: Redis
      EngineVersion: 6.x
      MultiAZEnabled: true
      NumNodeGroups: 1
      ReplicasPerNodeGroup: 1
      ReplicationGroupId: redisSingleAuthDemo
      SecurityGroupIds:
        - Fn::GetAtt:
            - ElastiCacheSG1EAF1356
            - GroupId
      TransitEncryptionEnabled: true
    Metadata:
      aws:cdk:path: RedisSecretRotationDemo/SingleAuth/RedisReplicationGroup
  SingleAuthrotatorRoleF3AD6A51:
    Type: AWS::IAM::Role
    Properties:
      AssumeRolePolicyDocument:
        Statement:
          - Action: sts:AssumeRole
            Effect: Allow
            Principal:
              Service: lambda.amazonaws.com
        Version: "2012-10-17"
      Description: Role to be assumed by producer  lambda
      ManagedPolicyArns:
        - Fn::Join:
            - ""
            - - "arn:"
              - Ref: AWS::Partition
              - :iam::aws:policy/service-role/AWSLambdaBasicExecutionRole
        - Fn::Join:
            - ""
            - - "arn:"
              - Ref: AWS::Partition
              - :iam::aws:policy/service-role/AWSLambdaVPCAccessExecutionRole
    Metadata:
      aws:cdk:path: RedisSecretRotationDemo/SingleAuth/rotatorRole/Resource
  SingleAuthrotatorRoleDefaultPolicyF993E0B3:
    Type: AWS::IAM::Policy
    Properties:
      PolicyDocument:
        Statement:
          - Action:
              - secretsmanager:DescribeSecret
              - secretsmanager:GetSecretValue
              - secretsmanager:PutSecretValue
              - secretsmanager:UpdateSecretVersionStage
            Effect: Allow
            Resource:
              Ref: SingleAuthRedisAuth48A2B3DE
          - Action:
              - elasticache:DescribeReplicationGroups
              - elasticache:ModifyReplicationGroup
            Effect: Allow
            Resource:
              Fn::Join:
                - ""
                - - "arn:aws:elasticache:"
                  - Ref: AWS::Region
                  - ":"
                  - Ref: AWS::AccountId
                  - :replicationgroup:redissingleauthdemo
          - Action: secretsmanager:GetRandomPassword
            Effect: Allow
            Resource: "*"
          - Action:
              - secretsmanager:GetSecretValue
              - secretsmanager:DescribeSecret
            Effect: Allow
            Resource:
              Ref: SingleAuthRedisAuth48A2B3DE
        Version: "2012-10-17"
      PolicyName: SingleAuthrotatorRoleDefaultPolicyF993E0B3
      Roles:
        - Ref: SingleAuthrotatorRoleF3AD6A51
    Metadata:
      aws:cdk:path: RedisSecretRotationDemo/SingleAuth/rotatorRole/DefaultPolicy/Resource
  SingleAuthredispyLayer5EFC3388:
    Type: AWS::Lambda::LayerVersion
    Properties:
      Content:
        S3Bucket:
          Ref: AssetParameters29b372f569db967448934a16e0b22a901d91823e60de1aa75dfc32a9372c323eS3Bucket813D4950
        S3Key:
          Fn::Join:
            - ""
            - - Fn::Select:
                  - 0
                  - Fn::Split:
                      - "||"
                      - Ref: AssetParameters29b372f569db967448934a16e0b22a901d91823e60de1aa75dfc32a9372c323eS3VersionKeyB4F5789F
              - Fn::Select:
                  - 1
                  - Fn::Split:
                      - "||"
                      - Ref: AssetParameters29b372f569db967448934a16e0b22a901d91823e60de1aa75dfc32a9372c323eS3VersionKeyB4F5789F
      CompatibleRuntimes:
        - python3.8
        - python3.7
        - python3.6
      Description: A layer that contains the redispy module
      LicenseInfo: MIT License
    Metadata:
      aws:cdk:path: RedisSecretRotationDemo/SingleAuth/redispy_Layer/Resource
      aws:asset:path: asset.29b372f569db967448934a16e0b22a901d91823e60de1aa75dfc32a9372c323e.zip
      aws:asset:is-bundled: false
      aws:asset:property: Content
  SingleAuthfunction116FEAF0:
    Type: AWS::Lambda::Function
    Properties:
      Code:
        S3Bucket:
          Ref: AssetParametersdf1a571af421557678aef2c18b1316d97ae39baba9bd90d216b0a805f818b2ffS3Bucket348682C2
        S3Key:
          Fn::Join:
            - ""
            - - Fn::Select:
                  - 0
                  - Fn::Split:
                      - "||"
                      - Ref: AssetParametersdf1a571af421557678aef2c18b1316d97ae39baba9bd90d216b0a805f818b2ffS3VersionKey27C6F591
              - Fn::Select:
                  - 1
                  - Fn::Split:
                      - "||"
                      - Ref: AssetParametersdf1a571af421557678aef2c18b1316d97ae39baba9bd90d216b0a805f818b2ffS3VersionKey27C6F591
      Role:
        Fn::GetAtt:
          - SingleAuthrotatorRoleF3AD6A51
          - Arn
      Environment:
        Variables:
          replicationGroupId:
            Ref: SingleAuthRedisReplicationGroupAEBB5A46
          redis_endpoint:
            Fn::GetAtt:
              - SingleAuthRedisReplicationGroupAEBB5A46
              - PrimaryEndPoint.Address
          redis_port:
            Fn::GetAtt:
              - SingleAuthRedisReplicationGroupAEBB5A46
              - PrimaryEndPoint.Port
          EXCLUDE_CHARACTERS: "@%*()_+=`~{}|[]\\:\";'?,./"
          SECRETS_MANAGER_ENDPOINT:
            Fn::Join:
              - ""
              - - https://secretsmanager.
                - Ref: AWS::Region
                - .amazonaws.com
      Handler: lambda_handler.lambda_handler
      Layers:
        - Ref: SingleAuthredispyLayer5EFC3388
      Runtime: python3.7
      Timeout: 30
      VpcConfig:
        SecurityGroupIds:
          - Fn::GetAtt:
              - ElastiCacheSG1EAF1356
              - GroupId
          - Fn::GetAtt:
              - RotatorSGF4319483
              - GroupId
        SubnetIds:
          - Ref: elasticachedemovpcPrivateSubnet1SubnetE60FDB9E
          - Ref: elasticachedemovpcPrivateSubnet2SubnetB2DC7386
    DependsOn:
      - SingleAuthrotatorRoleDefaultPolicyF993E0B3
      - SingleAuthrotatorRoleF3AD6A51
    Metadata:
      aws:cdk:path: RedisSecretRotationDemo/SingleAuth/function/Resource
      aws:asset:path: asset.df1a571af421557678aef2c18b1316d97ae39baba9bd90d216b0a805f818b2ff
      aws:asset:is-bundled: false
      aws:asset:property: Code
  SingleAuthfunctionInvokeN0a2GKfZP0JmDqDEVhhu6A0TUv3NyNbk4YMFKNc448BF922:
    Type: AWS::Lambda::Permission
    Properties:
      Action: lambda:InvokeFunction
      FunctionName:
        Fn::GetAtt:
          - SingleAuthfunction116FEAF0
          - Arn
      Principal: secretsmanager.amazonaws.com
    Metadata:
      aws:cdk:path: RedisSecretRotationDemo/SingleAuth/function/InvokeN0--a2GKfZP0JmDqDE--Vhhu6+A0TUv3NyNbk4YM+FKNc=
  SingleAuthtesterRoleD677DCBF:
    Type: AWS::IAM::Role
    Properties:
      AssumeRolePolicyDocument:
        Statement:
          - Action: sts:AssumeRole
            Effect: Allow
            Principal:
              Service: lambda.amazonaws.com
        Version: "2012-10-17"
      Description: Role to be assumed by producer  lambda
      ManagedPolicyArns:
        - Fn::Join:
            - ""
            - - "arn:"
              - Ref: AWS::Partition
              - :iam::aws:policy/service-role/AWSLambdaBasicExecutionRole
        - Fn::Join:
            - ""
            - - "arn:"
              - Ref: AWS::Partition
              - :iam::aws:policy/service-role/AWSLambdaVPCAccessExecutionRole
    Metadata:
      aws:cdk:path: RedisSecretRotationDemo/SingleAuth/testerRole/Resource
  SingleAuthtesterRoleDefaultPolicyE041FEF6:
    Type: AWS::IAM::Policy
    Properties:
      PolicyDocument:
        Statement:
          - Action:
              - secretsmanager:DescribeSecret
              - secretsmanager:GetSecretValue
            Effect: Allow
            Resource:
              Ref: SingleAuthRedisAuth48A2B3DE
          - Action:
              - secretsmanager:GetSecretValue
              - secretsmanager:DescribeSecret
            Effect: Allow
            Resource:
              Ref: SingleAuthRedisAuth48A2B3DE
        Version: "2012-10-17"
      PolicyName: SingleAuthtesterRoleDefaultPolicyE041FEF6
      Roles:
        - Ref: SingleAuthtesterRoleD677DCBF
    Metadata:
      aws:cdk:path: RedisSecretRotationDemo/SingleAuth/testerRole/DefaultPolicy/Resource
  SingleAuthconnectionTestFunction6D3E23FC:
    Type: AWS::Lambda::Function
    Properties:
      Code:
        S3Bucket:
          Ref: AssetParameterscfdb3eaf890438a197a89004dd2089e43566354309400047947a5898767aa00bS3BucketD8229B72
        S3Key:
          Fn::Join:
            - ""
            - - Fn::Select:
                  - 0
                  - Fn::Split:
                      - "||"
                      - Ref: AssetParameterscfdb3eaf890438a197a89004dd2089e43566354309400047947a5898767aa00bS3VersionKeyD6281FE0
              - Fn::Select:
                  - 1
                  - Fn::Split:
                      - "||"
                      - Ref: AssetParameterscfdb3eaf890438a197a89004dd2089e43566354309400047947a5898767aa00bS3VersionKeyD6281FE0
      Role:
        Fn::GetAtt:
          - SingleAuthtesterRoleD677DCBF
          - Arn
      Environment:
        Variables:
          replicationGroupId:
            Ref: SingleAuthRedisReplicationGroupAEBB5A46
          redis_endpoint:
            Fn::GetAtt:
              - SingleAuthRedisReplicationGroupAEBB5A46
              - PrimaryEndPoint.Address
          redis_port:
            Fn::GetAtt:
              - SingleAuthRedisReplicationGroupAEBB5A46
              - PrimaryEndPoint.Port
          secret_arn:
            Ref: SingleAuthRedisAuth48A2B3DE
      Handler: lambda_tester.lambda_handler_single_auth
      Layers:
        - Ref: SingleAuthredispyLayer5EFC3388
      Runtime: python3.7
      Timeout: 30
      VpcConfig:
        SecurityGroupIds:
          - Fn::GetAtt:
              - ElastiCacheSG1EAF1356
              - GroupId
          - Fn::GetAtt:
              - RotatorSGF4319483
              - GroupId
        SubnetIds:
          - Ref: elasticachedemovpcPrivateSubnet1SubnetE60FDB9E
          - Ref: elasticachedemovpcPrivateSubnet2SubnetB2DC7386
    DependsOn:
      - SingleAuthtesterRoleDefaultPolicyE041FEF6
      - SingleAuthtesterRoleD677DCBF
    Metadata:
      aws:cdk:path: RedisSecretRotationDemo/SingleAuth/connectionTestFunction/Resource
      aws:asset:path: asset.cfdb3eaf890438a197a89004dd2089e43566354309400047947a5898767aa00b
      aws:asset:is-bundled: false
      aws:asset:property: Code
  RedisRbacRotatorredispyLayerEB0C89DF:
    Type: AWS::Lambda::LayerVersion
    Properties:
      Content:
        S3Bucket:
          Ref: AssetParameters29b372f569db967448934a16e0b22a901d91823e60de1aa75dfc32a9372c323eS3Bucket813D4950
        S3Key:
          Fn::Join:
            - ""
            - - Fn::Select:
                  - 0
                  - Fn::Split:
                      - "||"
                      - Ref: AssetParameters29b372f569db967448934a16e0b22a901d91823e60de1aa75dfc32a9372c323eS3VersionKeyB4F5789F
              - Fn::Select:
                  - 1
                  - Fn::Split:
                      - "||"
                      - Ref: AssetParameters29b372f569db967448934a16e0b22a901d91823e60de1aa75dfc32a9372c323eS3VersionKeyB4F5789F
      CompatibleRuntimes:
        - python3.8
        - python3.7
        - python3.6
      Description: A layer that contains the redispy module
      LicenseInfo: MIT License
    DependsOn:
      - elasticachedemovpcIGWB2D9A7B9
      - elasticachedemovpcPrivateSubnet1DefaultRouteDA9519AA
      - elasticachedemovpcPrivateSubnet1RouteTable76CF92D5
      - elasticachedemovpcPrivateSubnet1RouteTableAssociationBD62AA3D
      - elasticachedemovpcPrivateSubnet1SubnetE60FDB9E
      - elasticachedemovpcPrivateSubnet2DefaultRouteEC61918F
      - elasticachedemovpcPrivateSubnet2RouteTableE90EB37E
      - elasticachedemovpcPrivateSubnet2RouteTableAssociationDCDB2982
      - elasticachedemovpcPrivateSubnet2SubnetB2DC7386
      - elasticachedemovpcPublicSubnet1DefaultRoute4434C510
      - elasticachedemovpcPublicSubnet1EIP5C0EAFC9
      - elasticachedemovpcPublicSubnet1NATGateway092A3D52
      - elasticachedemovpcPublicSubnet1RouteTable881099C5
      - elasticachedemovpcPublicSubnet1RouteTableAssociation642BA55F
      - elasticachedemovpcPublicSubnet1Subnet6D468D4B
      - elasticachedemovpcPublicSubnet2DefaultRoute66ADBDEF
      - elasticachedemovpcPublicSubnet2EIP4CF0D987
      - elasticachedemovpcPublicSubnet2NATGateway229D2CEB
      - elasticachedemovpcPublicSubnet2RouteTableEE1F746A
      - elasticachedemovpcPublicSubnet2RouteTableAssociationE703F9FB
      - elasticachedemovpcPublicSubnet2SubnetF31209E6
      - elasticachedemovpc9EEF29B7
      - elasticachedemovpcVPCGWA922A7FA
      - ElastiCacheSG1EAF1356
      - ElastiCacheSubnetGroup
    Metadata:
      aws:cdk:path: RedisSecretRotationDemo/RedisRbacRotator/redispy_Layer/Resource
      aws:asset:path: asset.29b372f569db967448934a16e0b22a901d91823e60de1aa75dfc32a9372c323e.zip
      aws:asset:is-bundled: false
      aws:asset:property: Content
  RedisRbacRotatorrotationtestuserRoleAB225CFA:
    Type: AWS::IAM::Role
    Properties:
      AssumeRolePolicyDocument:
        Statement:
          - Action: sts:AssumeRole
            Effect: Allow
            Principal:
              Service: lambda.amazonaws.com
        Version: "2012-10-17"
      Description: Role to be assumed by producer lambda
      ManagedPolicyArns:
        - Fn::Join:
            - ""
            - - "arn:"
              - Ref: AWS::Partition
              - :iam::aws:policy/service-role/AWSLambdaBasicExecutionRole
        - Fn::Join:
            - ""
            - - "arn:"
              - Ref: AWS::Partition
              - :iam::aws:policy/service-role/AWSLambdaVPCAccessExecutionRole
    DependsOn:
      - elasticachedemovpcIGWB2D9A7B9
      - elasticachedemovpcPrivateSubnet1DefaultRouteDA9519AA
      - elasticachedemovpcPrivateSubnet1RouteTable76CF92D5
      - elasticachedemovpcPrivateSubnet1RouteTableAssociationBD62AA3D
      - elasticachedemovpcPrivateSubnet1SubnetE60FDB9E
      - elasticachedemovpcPrivateSubnet2DefaultRouteEC61918F
      - elasticachedemovpcPrivateSubnet2RouteTableE90EB37E
      - elasticachedemovpcPrivateSubnet2RouteTableAssociationDCDB2982
      - elasticachedemovpcPrivateSubnet2SubnetB2DC7386
      - elasticachedemovpcPublicSubnet1DefaultRoute4434C510
      - elasticachedemovpcPublicSubnet1EIP5C0EAFC9
      - elasticachedemovpcPublicSubnet1NATGateway092A3D52
      - elasticachedemovpcPublicSubnet1RouteTable881099C5
      - elasticachedemovpcPublicSubnet1RouteTableAssociation642BA55F
      - elasticachedemovpcPublicSubnet1Subnet6D468D4B
      - elasticachedemovpcPublicSubnet2DefaultRoute66ADBDEF
      - elasticachedemovpcPublicSubnet2EIP4CF0D987
      - elasticachedemovpcPublicSubnet2NATGateway229D2CEB
      - elasticachedemovpcPublicSubnet2RouteTableEE1F746A
      - elasticachedemovpcPublicSubnet2RouteTableAssociationE703F9FB
      - elasticachedemovpcPublicSubnet2SubnetF31209E6
      - elasticachedemovpc9EEF29B7
      - elasticachedemovpcVPCGWA922A7FA
      - ElastiCacheSG1EAF1356
      - ElastiCacheSubnetGroup
    Metadata:
      aws:cdk:path: RedisSecretRotationDemo/RedisRbacRotator/rotationtestuserRole/Resource
  RedisRbacRotatorrotationtestuserRoleDefaultPolicy525A6C39:
    Type: AWS::IAM::Policy
    Properties:
      PolicyDocument:
        Statement:
          - Action: kms:Decrypt
            Effect: Allow
            Resource:
              Fn::GetAtt:
                - RedisRbacRotatorrotationtestuserkmsForSecret6DEB49C1
                - Arn
          - Action:
              - secretsmanager:GetSecretValue
              - secretsmanager:DescribeSecret
            Effect: Allow
            Resource:
              Ref: RedisRbacRotatorrotationtestusersecret1DCACFF4
          - Action: kms:Decrypt
            Effect: Allow
            Resource:
              Fn::GetAtt:
                - RedisRbacRotatorrotationtestuseranoutherkmsForSecret703AF75D
                - Arn
          - Action:
              - secretsmanager:GetSecretValue
              - secretsmanager:DescribeSecret
            Effect: Allow
            Resource:
              Ref: RedisRbacRotatorrotationtestuseranouthersecret01843F3E
        Version: "2012-10-17"
      PolicyName: RedisRbacRotatorrotationtestuserRoleDefaultPolicy525A6C39
      Roles:
        - Ref: RedisRbacRotatorrotationtestuserRoleAB225CFA
    DependsOn:
      - elasticachedemovpcIGWB2D9A7B9
      - elasticachedemovpcPrivateSubnet1DefaultRouteDA9519AA
      - elasticachedemovpcPrivateSubnet1RouteTable76CF92D5
      - elasticachedemovpcPrivateSubnet1RouteTableAssociationBD62AA3D
      - elasticachedemovpcPrivateSubnet1SubnetE60FDB9E
      - elasticachedemovpcPrivateSubnet2DefaultRouteEC61918F
      - elasticachedemovpcPrivateSubnet2RouteTableE90EB37E
      - elasticachedemovpcPrivateSubnet2RouteTableAssociationDCDB2982
      - elasticachedemovpcPrivateSubnet2SubnetB2DC7386
      - elasticachedemovpcPublicSubnet1DefaultRoute4434C510
      - elasticachedemovpcPublicSubnet1EIP5C0EAFC9
      - elasticachedemovpcPublicSubnet1NATGateway092A3D52
      - elasticachedemovpcPublicSubnet1RouteTable881099C5
      - elasticachedemovpcPublicSubnet1RouteTableAssociation642BA55F
      - elasticachedemovpcPublicSubnet1Subnet6D468D4B
      - elasticachedemovpcPublicSubnet2DefaultRoute66ADBDEF
      - elasticachedemovpcPublicSubnet2EIP4CF0D987
      - elasticachedemovpcPublicSubnet2NATGateway229D2CEB
      - elasticachedemovpcPublicSubnet2RouteTableEE1F746A
      - elasticachedemovpcPublicSubnet2RouteTableAssociationE703F9FB
      - elasticachedemovpcPublicSubnet2SubnetF31209E6
      - elasticachedemovpc9EEF29B7
      - elasticachedemovpcVPCGWA922A7FA
      - ElastiCacheSG1EAF1356
      - ElastiCacheSubnetGroup
    Metadata:
      aws:cdk:path: RedisSecretRotationDemo/RedisRbacRotator/rotationtestuserRole/DefaultPolicy/Resource
  RedisRbacRotatorrotationtestuserkmsForSecret6DEB49C1:
    Type: AWS::KMS::Key
    Properties:
      KeyPolicy:
        Statement:
          - Action: kms:*
            Effect: Allow
            Principal:
              AWS:
                Fn::Join:
                  - ""
                  - - "arn:"
                    - Ref: AWS::Partition
                    - ":iam::"
                    - Ref: AWS::AccountId
                    - :root
            Resource: "*"
          - Action:
              - kms:Decrypt
              - kms:Encrypt
              - kms:ReEncrypt*
              - kms:GenerateDataKey*
            Condition:
              StringEquals:
                kms:ViaService:
                  Fn::Join:
                    - ""
                    - - secretsmanager.
                      - Ref: AWS::Region
                      - .amazonaws.com
            Effect: Allow
            Principal:
              AWS:
                Fn::Join:
                  - ""
                  - - "arn:"
                    - Ref: AWS::Partition
                    - ":iam::"
                    - Ref: AWS::AccountId
                    - :root
            Resource: "*"
          - Action:
              - kms:CreateGrant
              - kms:DescribeKey
            Condition:
              StringEquals:
                kms:ViaService:
                  Fn::Join:
                    - ""
                    - - secretsmanager.
                      - Ref: AWS::Region
                      - .amazonaws.com
            Effect: Allow
            Principal:
              AWS:
                Fn::Join:
                  - ""
                  - - "arn:"
                    - Ref: AWS::Partition
                    - ":iam::"
                    - Ref: AWS::AccountId
                    - :root
            Resource: "*"
          - Action: kms:Decrypt
            Condition:
              StringEquals:
                kms:ViaService:
                  Fn::Join:
                    - ""
                    - - secretsmanager.
                      - Ref: AWS::Region
                      - .amazonaws.com
            Effect: Allow
            Principal:
              AWS:
                Fn::GetAtt:
                  - RedisRbacRotatorrotationtestuserRoleAB225CFA
                  - Arn
            Resource: "*"
        Version: "2012-10-17"
      EnableKeyRotation: true
    DependsOn:
      - elasticachedemovpcIGWB2D9A7B9
      - elasticachedemovpcPrivateSubnet1DefaultRouteDA9519AA
      - elasticachedemovpcPrivateSubnet1RouteTable76CF92D5
      - elasticachedemovpcPrivateSubnet1RouteTableAssociationBD62AA3D
      - elasticachedemovpcPrivateSubnet1SubnetE60FDB9E
      - elasticachedemovpcPrivateSubnet2DefaultRouteEC61918F
      - elasticachedemovpcPrivateSubnet2RouteTableE90EB37E
      - elasticachedemovpcPrivateSubnet2RouteTableAssociationDCDB2982
      - elasticachedemovpcPrivateSubnet2SubnetB2DC7386
      - elasticachedemovpcPublicSubnet1DefaultRoute4434C510
      - elasticachedemovpcPublicSubnet1EIP5C0EAFC9
      - elasticachedemovpcPublicSubnet1NATGateway092A3D52
      - elasticachedemovpcPublicSubnet1RouteTable881099C5
      - elasticachedemovpcPublicSubnet1RouteTableAssociation642BA55F
      - elasticachedemovpcPublicSubnet1Subnet6D468D4B
      - elasticachedemovpcPublicSubnet2DefaultRoute66ADBDEF
      - elasticachedemovpcPublicSubnet2EIP4CF0D987
      - elasticachedemovpcPublicSubnet2NATGateway229D2CEB
      - elasticachedemovpcPublicSubnet2RouteTableEE1F746A
      - elasticachedemovpcPublicSubnet2RouteTableAssociationE703F9FB
      - elasticachedemovpcPublicSubnet2SubnetF31209E6
      - elasticachedemovpc9EEF29B7
      - elasticachedemovpcVPCGWA922A7FA
      - ElastiCacheSG1EAF1356
      - ElastiCacheSubnetGroup
    UpdateReplacePolicy: Retain
    DeletionPolicy: Retain
    Metadata:
      aws:cdk:path: RedisSecretRotationDemo/RedisRbacRotator/rotationtestuser/kmsForSecret/Resource
  RedisRbacRotatorrotationtestuserkmsForSecretAlias5A706502:
    Type: AWS::KMS::Alias
    Properties:
      AliasName: alias/rotator-demo/rotationtestuser
      TargetKeyId:
        Fn::GetAtt:
          - RedisRbacRotatorrotationtestuserkmsForSecret6DEB49C1
          - Arn
    DependsOn:
      - elasticachedemovpcIGWB2D9A7B9
      - elasticachedemovpcPrivateSubnet1DefaultRouteDA9519AA
      - elasticachedemovpcPrivateSubnet1RouteTable76CF92D5
      - elasticachedemovpcPrivateSubnet1RouteTableAssociationBD62AA3D
      - elasticachedemovpcPrivateSubnet1SubnetE60FDB9E
      - elasticachedemovpcPrivateSubnet2DefaultRouteEC61918F
      - elasticachedemovpcPrivateSubnet2RouteTableE90EB37E
      - elasticachedemovpcPrivateSubnet2RouteTableAssociationDCDB2982
      - elasticachedemovpcPrivateSubnet2SubnetB2DC7386
      - elasticachedemovpcPublicSubnet1DefaultRoute4434C510
      - elasticachedemovpcPublicSubnet1EIP5C0EAFC9
      - elasticachedemovpcPublicSubnet1NATGateway092A3D52
      - elasticachedemovpcPublicSubnet1RouteTable881099C5
      - elasticachedemovpcPublicSubnet1RouteTableAssociation642BA55F
      - elasticachedemovpcPublicSubnet1Subnet6D468D4B
      - elasticachedemovpcPublicSubnet2DefaultRoute66ADBDEF
      - elasticachedemovpcPublicSubnet2EIP4CF0D987
      - elasticachedemovpcPublicSubnet2NATGateway229D2CEB
      - elasticachedemovpcPublicSubnet2RouteTableEE1F746A
      - elasticachedemovpcPublicSubnet2RouteTableAssociationE703F9FB
      - elasticachedemovpcPublicSubnet2SubnetF31209E6
      - elasticachedemovpc9EEF29B7
      - elasticachedemovpcVPCGWA922A7FA
      - ElastiCacheSG1EAF1356
      - ElastiCacheSubnetGroup
    Metadata:
      aws:cdk:path: RedisSecretRotationDemo/RedisRbacRotator/rotationtestuser/kmsForSecret/Alias/Resource
  RedisRbacRotatorrotationtestusersecret1DCACFF4:
    Type: AWS::SecretsManager::Secret
    Properties:
      GenerateSecretString:
        ExcludeCharacters: "@%*()_+=`~{}|[]\\:\";'?,./"
        GenerateStringKey: password
        SecretStringTemplate: '{"username":"rotator-demo/rotationtestuser"}'
      KmsKeyId:
        Fn::GetAtt:
          - RedisRbacRotatorrotationtestuserkmsForSecret6DEB49C1
          - Arn
    DependsOn:
      - elasticachedemovpcIGWB2D9A7B9
      - elasticachedemovpcPrivateSubnet1DefaultRouteDA9519AA
      - elasticachedemovpcPrivateSubnet1RouteTable76CF92D5
      - elasticachedemovpcPrivateSubnet1RouteTableAssociationBD62AA3D
      - elasticachedemovpcPrivateSubnet1SubnetE60FDB9E
      - elasticachedemovpcPrivateSubnet2DefaultRouteEC61918F
      - elasticachedemovpcPrivateSubnet2RouteTableE90EB37E
      - elasticachedemovpcPrivateSubnet2RouteTableAssociationDCDB2982
      - elasticachedemovpcPrivateSubnet2SubnetB2DC7386
      - elasticachedemovpcPublicSubnet1DefaultRoute4434C510
      - elasticachedemovpcPublicSubnet1EIP5C0EAFC9
      - elasticachedemovpcPublicSubnet1NATGateway092A3D52
      - elasticachedemovpcPublicSubnet1RouteTable881099C5
      - elasticachedemovpcPublicSubnet1RouteTableAssociation642BA55F
      - elasticachedemovpcPublicSubnet1Subnet6D468D4B
      - elasticachedemovpcPublicSubnet2DefaultRoute66ADBDEF
      - elasticachedemovpcPublicSubnet2EIP4CF0D987
      - elasticachedemovpcPublicSubnet2NATGateway229D2CEB
      - elasticachedemovpcPublicSubnet2RouteTableEE1F746A
      - elasticachedemovpcPublicSubnet2RouteTableAssociationE703F9FB
      - elasticachedemovpcPublicSubnet2SubnetF31209E6
      - elasticachedemovpc9EEF29B7
      - elasticachedemovpcVPCGWA922A7FA
      - ElastiCacheSG1EAF1356
      - ElastiCacheSubnetGroup
    UpdateReplacePolicy: Delete
    DeletionPolicy: Delete
    Metadata:
      aws:cdk:path: RedisSecretRotationDemo/RedisRbacRotator/rotationtestuser/secret/Resource
  RedisRbacRotatorrotationtestusersecretPolicy4CDFA2BC:
    Type: AWS::SecretsManager::ResourcePolicy
    Properties:
      ResourcePolicy:
        Statement:
          - Action:
              - secretsmanager:DescribeSecret
              - secretsmanager:GetSecretValue
            Effect: Allow
            Principal:
              AWS:
                Fn::GetAtt:
                  - RedisRbacRotatorrotationtestuserRoleAB225CFA
                  - Arn
            Resource:
              Ref: RedisRbacRotatorrotationtestusersecret1DCACFF4
        Version: "2012-10-17"
      SecretId:
        Ref: RedisRbacRotatorrotationtestusersecret1DCACFF4
    DependsOn:
      - elasticachedemovpcIGWB2D9A7B9
      - elasticachedemovpcPrivateSubnet1DefaultRouteDA9519AA
      - elasticachedemovpcPrivateSubnet1RouteTable76CF92D5
      - elasticachedemovpcPrivateSubnet1RouteTableAssociationBD62AA3D
      - elasticachedemovpcPrivateSubnet1SubnetE60FDB9E
      - elasticachedemovpcPrivateSubnet2DefaultRouteEC61918F
      - elasticachedemovpcPrivateSubnet2RouteTableE90EB37E
      - elasticachedemovpcPrivateSubnet2RouteTableAssociationDCDB2982
      - elasticachedemovpcPrivateSubnet2SubnetB2DC7386
      - elasticachedemovpcPublicSubnet1DefaultRoute4434C510
      - elasticachedemovpcPublicSubnet1EIP5C0EAFC9
      - elasticachedemovpcPublicSubnet1NATGateway092A3D52
      - elasticachedemovpcPublicSubnet1RouteTable881099C5
      - elasticachedemovpcPublicSubnet1RouteTableAssociation642BA55F
      - elasticachedemovpcPublicSubnet1Subnet6D468D4B
      - elasticachedemovpcPublicSubnet2DefaultRoute66ADBDEF
      - elasticachedemovpcPublicSubnet2EIP4CF0D987
      - elasticachedemovpcPublicSubnet2NATGateway229D2CEB
      - elasticachedemovpcPublicSubnet2RouteTableEE1F746A
      - elasticachedemovpcPublicSubnet2RouteTableAssociationE703F9FB
      - elasticachedemovpcPublicSubnet2SubnetF31209E6
      - elasticachedemovpc9EEF29B7
      - elasticachedemovpcVPCGWA922A7FA
      - ElastiCacheSG1EAF1356
      - ElastiCacheSubnetGroup
    Metadata:
      aws:cdk:path: RedisSecretRotationDemo/RedisRbacRotator/rotationtestuser/secret/Policy/Resource
  RedisRbacRotatorrotationtestuserredisuser89DAD8FD:
    Type: AWS::ElastiCache::User
    Properties:
      Engine: redis
      UserId: rotationtestuser
      UserName: rotator-demo/rotationtestuser
      AccessString: on ~* -@all +SET
      Passwords:
        - Fn::Join:
            - ""
            - - "{{resolve:secretsmanager:"
              - Ref: RedisRbacRotatorrotationtestusersecret1DCACFF4
              - :SecretString:password::}}
    DependsOn:
      - elasticachedemovpcIGWB2D9A7B9
      - elasticachedemovpcPrivateSubnet1DefaultRouteDA9519AA
      - elasticachedemovpcPrivateSubnet1RouteTable76CF92D5
      - elasticachedemovpcPrivateSubnet1RouteTableAssociationBD62AA3D
      - elasticachedemovpcPrivateSubnet1SubnetE60FDB9E
      - elasticachedemovpcPrivateSubnet2DefaultRouteEC61918F
      - elasticachedemovpcPrivateSubnet2RouteTableE90EB37E
      - elasticachedemovpcPrivateSubnet2RouteTableAssociationDCDB2982
      - elasticachedemovpcPrivateSubnet2SubnetB2DC7386
      - elasticachedemovpcPublicSubnet1DefaultRoute4434C510
      - elasticachedemovpcPublicSubnet1EIP5C0EAFC9
      - elasticachedemovpcPublicSubnet1NATGateway092A3D52
      - elasticachedemovpcPublicSubnet1RouteTable881099C5
      - elasticachedemovpcPublicSubnet1RouteTableAssociation642BA55F
      - elasticachedemovpcPublicSubnet1Subnet6D468D4B
      - elasticachedemovpcPublicSubnet2DefaultRoute66ADBDEF
      - elasticachedemovpcPublicSubnet2EIP4CF0D987
      - elasticachedemovpcPublicSubnet2NATGateway229D2CEB
      - elasticachedemovpcPublicSubnet2RouteTableEE1F746A
      - elasticachedemovpcPublicSubnet2RouteTableAssociationE703F9FB
      - elasticachedemovpcPublicSubnet2SubnetF31209E6
      - elasticachedemovpc9EEF29B7
      - elasticachedemovpcVPCGWA922A7FA
      - ElastiCacheSG1EAF1356
      - ElastiCacheSubnetGroup
      - RedisRbacRotatorrotationtestusersecretPolicy4CDFA2BC
      - RedisRbacRotatorrotationtestusersecret1DCACFF4
    Metadata:
      aws:cdk:path: RedisSecretRotationDemo/RedisRbacRotator/rotationtestuser/redisuser
  RedisRbacRotatorrotationtestuserrotatorRole3A08D84D:
    Type: AWS::IAM::Role
    Properties:
      AssumeRolePolicyDocument:
        Statement:
          - Action: sts:AssumeRole
            Effect: Allow
            Principal:
              Service: lambda.amazonaws.com
        Version: "2012-10-17"
      Description: Role to be assumed by producer  lambda
      ManagedPolicyArns:
        - Fn::Join:
            - ""
            - - "arn:"
              - Ref: AWS::Partition
              - :iam::aws:policy/service-role/AWSLambdaBasicExecutionRole
        - Fn::Join:
            - ""
            - - "arn:"
              - Ref: AWS::Partition
              - :iam::aws:policy/service-role/AWSLambdaVPCAccessExecutionRole
    DependsOn:
      - elasticachedemovpcIGWB2D9A7B9
      - elasticachedemovpcPrivateSubnet1DefaultRouteDA9519AA
      - elasticachedemovpcPrivateSubnet1RouteTable76CF92D5
      - elasticachedemovpcPrivateSubnet1RouteTableAssociationBD62AA3D
      - elasticachedemovpcPrivateSubnet1SubnetE60FDB9E
      - elasticachedemovpcPrivateSubnet2DefaultRouteEC61918F
      - elasticachedemovpcPrivateSubnet2RouteTableE90EB37E
      - elasticachedemovpcPrivateSubnet2RouteTableAssociationDCDB2982
      - elasticachedemovpcPrivateSubnet2SubnetB2DC7386
      - elasticachedemovpcPublicSubnet1DefaultRoute4434C510
      - elasticachedemovpcPublicSubnet1EIP5C0EAFC9
      - elasticachedemovpcPublicSubnet1NATGateway092A3D52
      - elasticachedemovpcPublicSubnet1RouteTable881099C5
      - elasticachedemovpcPublicSubnet1RouteTableAssociation642BA55F
      - elasticachedemovpcPublicSubnet1Subnet6D468D4B
      - elasticachedemovpcPublicSubnet2DefaultRoute66ADBDEF
      - elasticachedemovpcPublicSubnet2EIP4CF0D987
      - elasticachedemovpcPublicSubnet2NATGateway229D2CEB
      - elasticachedemovpcPublicSubnet2RouteTableEE1F746A
      - elasticachedemovpcPublicSubnet2RouteTableAssociationE703F9FB
      - elasticachedemovpcPublicSubnet2SubnetF31209E6
      - elasticachedemovpc9EEF29B7
      - elasticachedemovpcVPCGWA922A7FA
      - ElastiCacheSG1EAF1356
      - ElastiCacheSubnetGroup
    Metadata:
      aws:cdk:path: RedisSecretRotationDemo/RedisRbacRotator/rotationtestuser/rotatorRole/Resource
  RedisRbacRotatorrotationtestuserrotatorRoleDefaultPolicy1B53EE35:
    Type: AWS::IAM::Policy
    Properties:
      PolicyDocument:
        Statement:
          - Action:
              - secretsmanager:DescribeSecret
              - secretsmanager:GetSecretValue
              - secretsmanager:PutSecretValue
              - secretsmanager:UpdateSecretVersionStage
            Effect: Allow
            Resource:
              Ref: RedisRbacRotatorrotationtestusersecret1DCACFF4
          - Action: secretsmanager:GetRandomPassword
            Effect: Allow
            Resource: "*"
        Version: "2012-10-17"
      PolicyName: RedisRbacRotatorrotationtestuserrotatorRoleDefaultPolicy1B53EE35
      Roles:
        - Ref: RedisRbacRotatorrotationtestuserrotatorRole3A08D84D
    DependsOn:
      - elasticachedemovpcIGWB2D9A7B9
      - elasticachedemovpcPrivateSubnet1DefaultRouteDA9519AA
      - elasticachedemovpcPrivateSubnet1RouteTable76CF92D5
      - elasticachedemovpcPrivateSubnet1RouteTableAssociationBD62AA3D
      - elasticachedemovpcPrivateSubnet1SubnetE60FDB9E
      - elasticachedemovpcPrivateSubnet2DefaultRouteEC61918F
      - elasticachedemovpcPrivateSubnet2RouteTableE90EB37E
      - elasticachedemovpcPrivateSubnet2RouteTableAssociationDCDB2982
      - elasticachedemovpcPrivateSubnet2SubnetB2DC7386
      - elasticachedemovpcPublicSubnet1DefaultRoute4434C510
      - elasticachedemovpcPublicSubnet1EIP5C0EAFC9
      - elasticachedemovpcPublicSubnet1NATGateway092A3D52
      - elasticachedemovpcPublicSubnet1RouteTable881099C5
      - elasticachedemovpcPublicSubnet1RouteTableAssociation642BA55F
      - elasticachedemovpcPublicSubnet1Subnet6D468D4B
      - elasticachedemovpcPublicSubnet2DefaultRoute66ADBDEF
      - elasticachedemovpcPublicSubnet2EIP4CF0D987
      - elasticachedemovpcPublicSubnet2NATGateway229D2CEB
      - elasticachedemovpcPublicSubnet2RouteTableEE1F746A
      - elasticachedemovpcPublicSubnet2RouteTableAssociationE703F9FB
      - elasticachedemovpcPublicSubnet2SubnetF31209E6
      - elasticachedemovpc9EEF29B7
      - elasticachedemovpcVPCGWA922A7FA
      - ElastiCacheSG1EAF1356
      - ElastiCacheSubnetGroup
    Metadata:
      aws:cdk:path: RedisSecretRotationDemo/RedisRbacRotator/rotationtestuser/rotatorRole/DefaultPolicy/Resource
  RedisRbacRotatorrotationtestuserrbacRotatorFunctionA6E25756:
    Type: AWS::Lambda::Function
    Properties:
      Code:
        S3Bucket:
          Ref: AssetParametersdf1a571af421557678aef2c18b1316d97ae39baba9bd90d216b0a805f818b2ffS3Bucket348682C2
        S3Key:
          Fn::Join:
            - ""
            - - Fn::Select:
                  - 0
                  - Fn::Split:
                      - "||"
                      - Ref: AssetParametersdf1a571af421557678aef2c18b1316d97ae39baba9bd90d216b0a805f818b2ffS3VersionKey27C6F591
              - Fn::Select:
                  - 1
                  - Fn::Split:
                      - "||"
                      - Ref: AssetParametersdf1a571af421557678aef2c18b1316d97ae39baba9bd90d216b0a805f818b2ffS3VersionKey27C6F591
      Role:
        Fn::GetAtt:
          - RedisRbacRotatorrotationtestuserrotatorRole3A08D84D
          - Arn
      Environment:
        Variables:
          secret_arn:
            Ref: RedisRbacRotatorrotationtestusersecret1DCACFF4
      Handler: lambda_tester.lambda_handler
      Layers:
        - Ref: RedisRbacRotatorredispyLayerEB0C89DF
      Runtime: python3.7
      VpcConfig:
        SecurityGroupIds:
          - Fn::GetAtt:
              - ElastiCacheSG1EAF1356
              - GroupId
          - Fn::GetAtt:
              - RotatorSGF4319483
              - GroupId
        SubnetIds:
          - Ref: elasticachedemovpcPrivateSubnet1SubnetE60FDB9E
          - Ref: elasticachedemovpcPrivateSubnet2SubnetB2DC7386
    DependsOn:
      - elasticachedemovpcIGWB2D9A7B9
      - elasticachedemovpcPrivateSubnet1DefaultRouteDA9519AA
      - elasticachedemovpcPrivateSubnet1RouteTable76CF92D5
      - elasticachedemovpcPrivateSubnet1RouteTableAssociationBD62AA3D
      - elasticachedemovpcPrivateSubnet1SubnetE60FDB9E
      - elasticachedemovpcPrivateSubnet2DefaultRouteEC61918F
      - elasticachedemovpcPrivateSubnet2RouteTableE90EB37E
      - elasticachedemovpcPrivateSubnet2RouteTableAssociationDCDB2982
      - elasticachedemovpcPrivateSubnet2SubnetB2DC7386
      - elasticachedemovpcPublicSubnet1DefaultRoute4434C510
      - elasticachedemovpcPublicSubnet1EIP5C0EAFC9
      - elasticachedemovpcPublicSubnet1NATGateway092A3D52
      - elasticachedemovpcPublicSubnet1RouteTable881099C5
      - elasticachedemovpcPublicSubnet1RouteTableAssociation642BA55F
      - elasticachedemovpcPublicSubnet1Subnet6D468D4B
      - elasticachedemovpcPublicSubnet2DefaultRoute66ADBDEF
      - elasticachedemovpcPublicSubnet2EIP4CF0D987
      - elasticachedemovpcPublicSubnet2NATGateway229D2CEB
      - elasticachedemovpcPublicSubnet2RouteTableEE1F746A
      - elasticachedemovpcPublicSubnet2RouteTableAssociationE703F9FB
      - elasticachedemovpcPublicSubnet2SubnetF31209E6
      - elasticachedemovpc9EEF29B7
      - elasticachedemovpcVPCGWA922A7FA
      - ElastiCacheSG1EAF1356
      - ElastiCacheSubnetGroup
      - RedisRbacRotatorrotationtestuserrotatorRoleDefaultPolicy1B53EE35
      - RedisRbacRotatorrotationtestuserrotatorRole3A08D84D
    Metadata:
      aws:cdk:path: RedisSecretRotationDemo/RedisRbacRotator/rotationtestuser/rbacRotatorFunction/Resource
      aws:asset:path: asset.df1a571af421557678aef2c18b1316d97ae39baba9bd90d216b0a805f818b2ff
      aws:asset:is-bundled: false
      aws:asset:property: Code
  RedisRbacRotatorrotationtestuseranoutherkmsForSecret703AF75D:
    Type: AWS::KMS::Key
    Properties:
      KeyPolicy:
        Statement:
          - Action: kms:*
            Effect: Allow
            Principal:
              AWS:
                Fn::Join:
                  - ""
                  - - "arn:"
                    - Ref: AWS::Partition
                    - ":iam::"
                    - Ref: AWS::AccountId
                    - :root
            Resource: "*"
          - Action:
              - kms:Decrypt
              - kms:Encrypt
              - kms:ReEncrypt*
              - kms:GenerateDataKey*
            Condition:
              StringEquals:
                kms:ViaService:
                  Fn::Join:
                    - ""
                    - - secretsmanager.
                      - Ref: AWS::Region
                      - .amazonaws.com
            Effect: Allow
            Principal:
              AWS:
                Fn::Join:
                  - ""
                  - - "arn:"
                    - Ref: AWS::Partition
                    - ":iam::"
                    - Ref: AWS::AccountId
                    - :root
            Resource: "*"
          - Action:
              - kms:CreateGrant
              - kms:DescribeKey
            Condition:
              StringEquals:
                kms:ViaService:
                  Fn::Join:
                    - ""
                    - - secretsmanager.
                      - Ref: AWS::Region
                      - .amazonaws.com
            Effect: Allow
            Principal:
              AWS:
                Fn::Join:
                  - ""
                  - - "arn:"
                    - Ref: AWS::Partition
                    - ":iam::"
                    - Ref: AWS::AccountId
                    - :root
            Resource: "*"
          - Action: kms:Decrypt
            Condition:
              StringEquals:
                kms:ViaService:
                  Fn::Join:
                    - ""
                    - - secretsmanager.
                      - Ref: AWS::Region
                      - .amazonaws.com
            Effect: Allow
            Principal:
              AWS:
                Fn::GetAtt:
                  - RedisRbacRotatorrotationtestuserRoleAB225CFA
                  - Arn
            Resource: "*"
        Version: "2012-10-17"
      EnableKeyRotation: true
    DependsOn:
      - elasticachedemovpcIGWB2D9A7B9
      - elasticachedemovpcPrivateSubnet1DefaultRouteDA9519AA
      - elasticachedemovpcPrivateSubnet1RouteTable76CF92D5
      - elasticachedemovpcPrivateSubnet1RouteTableAssociationBD62AA3D
      - elasticachedemovpcPrivateSubnet1SubnetE60FDB9E
      - elasticachedemovpcPrivateSubnet2DefaultRouteEC61918F
      - elasticachedemovpcPrivateSubnet2RouteTableE90EB37E
      - elasticachedemovpcPrivateSubnet2RouteTableAssociationDCDB2982
      - elasticachedemovpcPrivateSubnet2SubnetB2DC7386
      - elasticachedemovpcPublicSubnet1DefaultRoute4434C510
      - elasticachedemovpcPublicSubnet1EIP5C0EAFC9
      - elasticachedemovpcPublicSubnet1NATGateway092A3D52
      - elasticachedemovpcPublicSubnet1RouteTable881099C5
      - elasticachedemovpcPublicSubnet1RouteTableAssociation642BA55F
      - elasticachedemovpcPublicSubnet1Subnet6D468D4B
      - elasticachedemovpcPublicSubnet2DefaultRoute66ADBDEF
      - elasticachedemovpcPublicSubnet2EIP4CF0D987
      - elasticachedemovpcPublicSubnet2NATGateway229D2CEB
      - elasticachedemovpcPublicSubnet2RouteTableEE1F746A
      - elasticachedemovpcPublicSubnet2RouteTableAssociationE703F9FB
      - elasticachedemovpcPublicSubnet2SubnetF31209E6
      - elasticachedemovpc9EEF29B7
      - elasticachedemovpcVPCGWA922A7FA
      - ElastiCacheSG1EAF1356
      - ElastiCacheSubnetGroup
    UpdateReplacePolicy: Retain
    DeletionPolicy: Retain
    Metadata:
      aws:cdk:path: RedisSecretRotationDemo/RedisRbacRotator/rotationtestuseranouther/kmsForSecret/Resource
  RedisRbacRotatorrotationtestuseranoutherkmsForSecretAliasF5791889:
    Type: AWS::KMS::Alias
    Properties:
      AliasName: alias/rotator-demo/anothertestuser
      TargetKeyId:
        Fn::GetAtt:
          - RedisRbacRotatorrotationtestuseranoutherkmsForSecret703AF75D
          - Arn
    DependsOn:
      - elasticachedemovpcIGWB2D9A7B9
      - elasticachedemovpcPrivateSubnet1DefaultRouteDA9519AA
      - elasticachedemovpcPrivateSubnet1RouteTable76CF92D5
      - elasticachedemovpcPrivateSubnet1RouteTableAssociationBD62AA3D
      - elasticachedemovpcPrivateSubnet1SubnetE60FDB9E
      - elasticachedemovpcPrivateSubnet2DefaultRouteEC61918F
      - elasticachedemovpcPrivateSubnet2RouteTableE90EB37E
      - elasticachedemovpcPrivateSubnet2RouteTableAssociationDCDB2982
      - elasticachedemovpcPrivateSubnet2SubnetB2DC7386
      - elasticachedemovpcPublicSubnet1DefaultRoute4434C510
      - elasticachedemovpcPublicSubnet1EIP5C0EAFC9
      - elasticachedemovpcPublicSubnet1NATGateway092A3D52
      - elasticachedemovpcPublicSubnet1RouteTable881099C5
      - elasticachedemovpcPublicSubnet1RouteTableAssociation642BA55F
      - elasticachedemovpcPublicSubnet1Subnet6D468D4B
      - elasticachedemovpcPublicSubnet2DefaultRoute66ADBDEF
      - elasticachedemovpcPublicSubnet2EIP4CF0D987
      - elasticachedemovpcPublicSubnet2NATGateway229D2CEB
      - elasticachedemovpcPublicSubnet2RouteTableEE1F746A
      - elasticachedemovpcPublicSubnet2RouteTableAssociationE703F9FB
      - elasticachedemovpcPublicSubnet2SubnetF31209E6
      - elasticachedemovpc9EEF29B7
      - elasticachedemovpcVPCGWA922A7FA
      - ElastiCacheSG1EAF1356
      - ElastiCacheSubnetGroup
    Metadata:
      aws:cdk:path: RedisSecretRotationDemo/RedisRbacRotator/rotationtestuseranouther/kmsForSecret/Alias/Resource
  RedisRbacRotatorrotationtestuseranouthersecret01843F3E:
    Type: AWS::SecretsManager::Secret
    Properties:
      GenerateSecretString:
        ExcludeCharacters: "@%*()_+=`~{}|[]\\:\";'?,./"
        GenerateStringKey: password
        SecretStringTemplate: '{"username":"rotator-demo/anothertestuser"}'
      KmsKeyId:
        Fn::GetAtt:
          - RedisRbacRotatorrotationtestuseranoutherkmsForSecret703AF75D
          - Arn
    DependsOn:
      - elasticachedemovpcIGWB2D9A7B9
      - elasticachedemovpcPrivateSubnet1DefaultRouteDA9519AA
      - elasticachedemovpcPrivateSubnet1RouteTable76CF92D5
      - elasticachedemovpcPrivateSubnet1RouteTableAssociationBD62AA3D
      - elasticachedemovpcPrivateSubnet1SubnetE60FDB9E
      - elasticachedemovpcPrivateSubnet2DefaultRouteEC61918F
      - elasticachedemovpcPrivateSubnet2RouteTableE90EB37E
      - elasticachedemovpcPrivateSubnet2RouteTableAssociationDCDB2982
      - elasticachedemovpcPrivateSubnet2SubnetB2DC7386
      - elasticachedemovpcPublicSubnet1DefaultRoute4434C510
      - elasticachedemovpcPublicSubnet1EIP5C0EAFC9
      - elasticachedemovpcPublicSubnet1NATGateway092A3D52
      - elasticachedemovpcPublicSubnet1RouteTable881099C5
      - elasticachedemovpcPublicSubnet1RouteTableAssociation642BA55F
      - elasticachedemovpcPublicSubnet1Subnet6D468D4B
      - elasticachedemovpcPublicSubnet2DefaultRoute66ADBDEF
      - elasticachedemovpcPublicSubnet2EIP4CF0D987
      - elasticachedemovpcPublicSubnet2NATGateway229D2CEB
      - elasticachedemovpcPublicSubnet2RouteTableEE1F746A
      - elasticachedemovpcPublicSubnet2RouteTableAssociationE703F9FB
      - elasticachedemovpcPublicSubnet2SubnetF31209E6
      - elasticachedemovpc9EEF29B7
      - elasticachedemovpcVPCGWA922A7FA
      - ElastiCacheSG1EAF1356
      - ElastiCacheSubnetGroup
    UpdateReplacePolicy: Delete
    DeletionPolicy: Delete
    Metadata:
      aws:cdk:path: RedisSecretRotationDemo/RedisRbacRotator/rotationtestuseranouther/secret/Resource
  RedisRbacRotatorrotationtestuseranouthersecretPolicy50A31697:
    Type: AWS::SecretsManager::ResourcePolicy
    Properties:
      ResourcePolicy:
        Statement:
          - Action:
              - secretsmanager:DescribeSecret
              - secretsmanager:GetSecretValue
            Effect: Allow
            Principal:
              AWS:
                Fn::GetAtt:
                  - RedisRbacRotatorrotationtestuserRoleAB225CFA
                  - Arn
            Resource:
              Ref: RedisRbacRotatorrotationtestuseranouthersecret01843F3E
        Version: "2012-10-17"
      SecretId:
        Ref: RedisRbacRotatorrotationtestuseranouthersecret01843F3E
    DependsOn:
      - elasticachedemovpcIGWB2D9A7B9
      - elasticachedemovpcPrivateSubnet1DefaultRouteDA9519AA
      - elasticachedemovpcPrivateSubnet1RouteTable76CF92D5
      - elasticachedemovpcPrivateSubnet1RouteTableAssociationBD62AA3D
      - elasticachedemovpcPrivateSubnet1SubnetE60FDB9E
      - elasticachedemovpcPrivateSubnet2DefaultRouteEC61918F
      - elasticachedemovpcPrivateSubnet2RouteTableE90EB37E
      - elasticachedemovpcPrivateSubnet2RouteTableAssociationDCDB2982
      - elasticachedemovpcPrivateSubnet2SubnetB2DC7386
      - elasticachedemovpcPublicSubnet1DefaultRoute4434C510
      - elasticachedemovpcPublicSubnet1EIP5C0EAFC9
      - elasticachedemovpcPublicSubnet1NATGateway092A3D52
      - elasticachedemovpcPublicSubnet1RouteTable881099C5
      - elasticachedemovpcPublicSubnet1RouteTableAssociation642BA55F
      - elasticachedemovpcPublicSubnet1Subnet6D468D4B
      - elasticachedemovpcPublicSubnet2DefaultRoute66ADBDEF
      - elasticachedemovpcPublicSubnet2EIP4CF0D987
      - elasticachedemovpcPublicSubnet2NATGateway229D2CEB
      - elasticachedemovpcPublicSubnet2RouteTableEE1F746A
      - elasticachedemovpcPublicSubnet2RouteTableAssociationE703F9FB
      - elasticachedemovpcPublicSubnet2SubnetF31209E6
      - elasticachedemovpc9EEF29B7
      - elasticachedemovpcVPCGWA922A7FA
      - ElastiCacheSG1EAF1356
      - ElastiCacheSubnetGroup
    Metadata:
      aws:cdk:path: RedisSecretRotationDemo/RedisRbacRotator/rotationtestuseranouther/secret/Policy/Resource
  RedisRbacRotatorrotationtestuseranoutherredisuserB6270AB8:
    Type: AWS::ElastiCache::User
    Properties:
      Engine: redis
      UserId: anotherrotationtestuser
      UserName: rotator-demo/anothertestuser
      AccessString: on ~* -@all +SET
      Passwords:
        - Fn::Join:
            - ""
            - - "{{resolve:secretsmanager:"
              - Ref: RedisRbacRotatorrotationtestuseranouthersecret01843F3E
              - :SecretString:password::}}
    DependsOn:
      - elasticachedemovpcIGWB2D9A7B9
      - elasticachedemovpcPrivateSubnet1DefaultRouteDA9519AA
      - elasticachedemovpcPrivateSubnet1RouteTable76CF92D5
      - elasticachedemovpcPrivateSubnet1RouteTableAssociationBD62AA3D
      - elasticachedemovpcPrivateSubnet1SubnetE60FDB9E
      - elasticachedemovpcPrivateSubnet2DefaultRouteEC61918F
      - elasticachedemovpcPrivateSubnet2RouteTableE90EB37E
      - elasticachedemovpcPrivateSubnet2RouteTableAssociationDCDB2982
      - elasticachedemovpcPrivateSubnet2SubnetB2DC7386
      - elasticachedemovpcPublicSubnet1DefaultRoute4434C510
      - elasticachedemovpcPublicSubnet1EIP5C0EAFC9
      - elasticachedemovpcPublicSubnet1NATGateway092A3D52
      - elasticachedemovpcPublicSubnet1RouteTable881099C5
      - elasticachedemovpcPublicSubnet1RouteTableAssociation642BA55F
      - elasticachedemovpcPublicSubnet1Subnet6D468D4B
      - elasticachedemovpcPublicSubnet2DefaultRoute66ADBDEF
      - elasticachedemovpcPublicSubnet2EIP4CF0D987
      - elasticachedemovpcPublicSubnet2NATGateway229D2CEB
      - elasticachedemovpcPublicSubnet2RouteTableEE1F746A
      - elasticachedemovpcPublicSubnet2RouteTableAssociationE703F9FB
      - elasticachedemovpcPublicSubnet2SubnetF31209E6
      - elasticachedemovpc9EEF29B7
      - elasticachedemovpcVPCGWA922A7FA
      - ElastiCacheSG1EAF1356
      - ElastiCacheSubnetGroup
      - RedisRbacRotatorrotationtestuseranouthersecretPolicy50A31697
      - RedisRbacRotatorrotationtestuseranouthersecret01843F3E
    Metadata:
      aws:cdk:path: RedisSecretRotationDemo/RedisRbacRotator/rotationtestuseranouther/redisuser
  RedisRbacRotatorrotationtestuseranoutherrotatorRoleC2347644:
    Type: AWS::IAM::Role
    Properties:
      AssumeRolePolicyDocument:
        Statement:
          - Action: sts:AssumeRole
            Effect: Allow
            Principal:
              Service: lambda.amazonaws.com
        Version: "2012-10-17"
      Description: Role to be assumed by producer  lambda
      ManagedPolicyArns:
        - Fn::Join:
            - ""
            - - "arn:"
              - Ref: AWS::Partition
              - :iam::aws:policy/service-role/AWSLambdaBasicExecutionRole
        - Fn::Join:
            - ""
            - - "arn:"
              - Ref: AWS::Partition
              - :iam::aws:policy/service-role/AWSLambdaVPCAccessExecutionRole
    DependsOn:
      - elasticachedemovpcIGWB2D9A7B9
      - elasticachedemovpcPrivateSubnet1DefaultRouteDA9519AA
      - elasticachedemovpcPrivateSubnet1RouteTable76CF92D5
      - elasticachedemovpcPrivateSubnet1RouteTableAssociationBD62AA3D
      - elasticachedemovpcPrivateSubnet1SubnetE60FDB9E
      - elasticachedemovpcPrivateSubnet2DefaultRouteEC61918F
      - elasticachedemovpcPrivateSubnet2RouteTableE90EB37E
      - elasticachedemovpcPrivateSubnet2RouteTableAssociationDCDB2982
      - elasticachedemovpcPrivateSubnet2SubnetB2DC7386
      - elasticachedemovpcPublicSubnet1DefaultRoute4434C510
      - elasticachedemovpcPublicSubnet1EIP5C0EAFC9
      - elasticachedemovpcPublicSubnet1NATGateway092A3D52
      - elasticachedemovpcPublicSubnet1RouteTable881099C5
      - elasticachedemovpcPublicSubnet1RouteTableAssociation642BA55F
      - elasticachedemovpcPublicSubnet1Subnet6D468D4B
      - elasticachedemovpcPublicSubnet2DefaultRoute66ADBDEF
      - elasticachedemovpcPublicSubnet2EIP4CF0D987
      - elasticachedemovpcPublicSubnet2NATGateway229D2CEB
      - elasticachedemovpcPublicSubnet2RouteTableEE1F746A
      - elasticachedemovpcPublicSubnet2RouteTableAssociationE703F9FB
      - elasticachedemovpcPublicSubnet2SubnetF31209E6
      - elasticachedemovpc9EEF29B7
      - elasticachedemovpcVPCGWA922A7FA
      - ElastiCacheSG1EAF1356
      - ElastiCacheSubnetGroup
    Metadata:
      aws:cdk:path: RedisSecretRotationDemo/RedisRbacRotator/rotationtestuseranouther/rotatorRole/Resource
  RedisRbacRotatorrotationtestuseranoutherrotatorRoleDefaultPolicy70EC2F74:
    Type: AWS::IAM::Policy
    Properties:
      PolicyDocument:
        Statement:
          - Action:
              - secretsmanager:DescribeSecret
              - secretsmanager:GetSecretValue
              - secretsmanager:PutSecretValue
              - secretsmanager:UpdateSecretVersionStage
            Effect: Allow
            Resource:
              Ref: RedisRbacRotatorrotationtestuseranouthersecret01843F3E
          - Action: secretsmanager:GetRandomPassword
            Effect: Allow
            Resource: "*"
        Version: "2012-10-17"
      PolicyName: RedisRbacRotatorrotationtestuseranoutherrotatorRoleDefaultPolicy70EC2F74
      Roles:
        - Ref: RedisRbacRotatorrotationtestuseranoutherrotatorRoleC2347644
    DependsOn:
      - elasticachedemovpcIGWB2D9A7B9
      - elasticachedemovpcPrivateSubnet1DefaultRouteDA9519AA
      - elasticachedemovpcPrivateSubnet1RouteTable76CF92D5
      - elasticachedemovpcPrivateSubnet1RouteTableAssociationBD62AA3D
      - elasticachedemovpcPrivateSubnet1SubnetE60FDB9E
      - elasticachedemovpcPrivateSubnet2DefaultRouteEC61918F
      - elasticachedemovpcPrivateSubnet2RouteTableE90EB37E
      - elasticachedemovpcPrivateSubnet2RouteTableAssociationDCDB2982
      - elasticachedemovpcPrivateSubnet2SubnetB2DC7386
      - elasticachedemovpcPublicSubnet1DefaultRoute4434C510
      - elasticachedemovpcPublicSubnet1EIP5C0EAFC9
      - elasticachedemovpcPublicSubnet1NATGateway092A3D52
      - elasticachedemovpcPublicSubnet1RouteTable881099C5
      - elasticachedemovpcPublicSubnet1RouteTableAssociation642BA55F
      - elasticachedemovpcPublicSubnet1Subnet6D468D4B
      - elasticachedemovpcPublicSubnet2DefaultRoute66ADBDEF
      - elasticachedemovpcPublicSubnet2EIP4CF0D987
      - elasticachedemovpcPublicSubnet2NATGateway229D2CEB
      - elasticachedemovpcPublicSubnet2RouteTableEE1F746A
      - elasticachedemovpcPublicSubnet2RouteTableAssociationE703F9FB
      - elasticachedemovpcPublicSubnet2SubnetF31209E6
      - elasticachedemovpc9EEF29B7
      - elasticachedemovpcVPCGWA922A7FA
      - ElastiCacheSG1EAF1356
      - ElastiCacheSubnetGroup
    Metadata:
      aws:cdk:path: RedisSecretRotationDemo/RedisRbacRotator/rotationtestuseranouther/rotatorRole/DefaultPolicy/Resource
  RedisRbacRotatorrotationtestuseranoutherrbacRotatorFunctionB9942219:
    Type: AWS::Lambda::Function
    Properties:
      Code:
        S3Bucket:
          Ref: AssetParametersdf1a571af421557678aef2c18b1316d97ae39baba9bd90d216b0a805f818b2ffS3Bucket348682C2
        S3Key:
          Fn::Join:
            - ""
            - - Fn::Select:
                  - 0
                  - Fn::Split:
                      - "||"
                      - Ref: AssetParametersdf1a571af421557678aef2c18b1316d97ae39baba9bd90d216b0a805f818b2ffS3VersionKey27C6F591
              - Fn::Select:
                  - 1
                  - Fn::Split:
                      - "||"
                      - Ref: AssetParametersdf1a571af421557678aef2c18b1316d97ae39baba9bd90d216b0a805f818b2ffS3VersionKey27C6F591
      Role:
        Fn::GetAtt:
          - RedisRbacRotatorrotationtestuseranoutherrotatorRoleC2347644
          - Arn
      Environment:
        Variables:
          secret_arn:
            Ref: RedisRbacRotatorrotationtestuseranouthersecret01843F3E
      Handler: lambda_tester.lambda_handler
      Layers:
        - Ref: RedisRbacRotatorredispyLayerEB0C89DF
      Runtime: python3.7
      VpcConfig:
        SecurityGroupIds:
          - Fn::GetAtt:
              - ElastiCacheSG1EAF1356
              - GroupId
          - Fn::GetAtt:
              - RotatorSGF4319483
              - GroupId
        SubnetIds:
          - Ref: elasticachedemovpcPrivateSubnet1SubnetE60FDB9E
          - Ref: elasticachedemovpcPrivateSubnet2SubnetB2DC7386
    DependsOn:
      - elasticachedemovpcIGWB2D9A7B9
      - elasticachedemovpcPrivateSubnet1DefaultRouteDA9519AA
      - elasticachedemovpcPrivateSubnet1RouteTable76CF92D5
      - elasticachedemovpcPrivateSubnet1RouteTableAssociationBD62AA3D
      - elasticachedemovpcPrivateSubnet1SubnetE60FDB9E
      - elasticachedemovpcPrivateSubnet2DefaultRouteEC61918F
      - elasticachedemovpcPrivateSubnet2RouteTableE90EB37E
      - elasticachedemovpcPrivateSubnet2RouteTableAssociationDCDB2982
      - elasticachedemovpcPrivateSubnet2SubnetB2DC7386
      - elasticachedemovpcPublicSubnet1DefaultRoute4434C510
      - elasticachedemovpcPublicSubnet1EIP5C0EAFC9
      - elasticachedemovpcPublicSubnet1NATGateway092A3D52
      - elasticachedemovpcPublicSubnet1RouteTable881099C5
      - elasticachedemovpcPublicSubnet1RouteTableAssociation642BA55F
      - elasticachedemovpcPublicSubnet1Subnet6D468D4B
      - elasticachedemovpcPublicSubnet2DefaultRoute66ADBDEF
      - elasticachedemovpcPublicSubnet2EIP4CF0D987
      - elasticachedemovpcPublicSubnet2NATGateway229D2CEB
      - elasticachedemovpcPublicSubnet2RouteTableEE1F746A
      - elasticachedemovpcPublicSubnet2RouteTableAssociationE703F9FB
      - elasticachedemovpcPublicSubnet2SubnetF31209E6
      - elasticachedemovpc9EEF29B7
      - elasticachedemovpcVPCGWA922A7FA
      - ElastiCacheSG1EAF1356
      - ElastiCacheSubnetGroup
      - RedisRbacRotatorrotationtestuseranoutherrotatorRoleDefaultPolicy70EC2F74
      - RedisRbacRotatorrotationtestuseranoutherrotatorRoleC2347644
    Metadata:
      aws:cdk:path: RedisSecretRotationDemo/RedisRbacRotator/rotationtestuseranouther/rbacRotatorFunction/Resource
      aws:asset:path: asset.df1a571af421557678aef2c18b1316d97ae39baba9bd90d216b0a805f818b2ff
      aws:asset:is-bundled: false
      aws:asset:property: Code
  RedisRbacRotatorgroupDefaultUserkmsForSecretFBDC38AA:
    Type: AWS::KMS::Key
    Properties:
      KeyPolicy:
        Statement:
          - Action: kms:*
            Effect: Allow
            Principal:
              AWS:
                Fn::Join:
                  - ""
                  - - "arn:"
                    - Ref: AWS::Partition
                    - ":iam::"
                    - Ref: AWS::AccountId
                    - :root
            Resource: "*"
          - Action:
              - kms:Decrypt
              - kms:Encrypt
              - kms:ReEncrypt*
              - kms:GenerateDataKey*
            Condition:
              StringEquals:
                kms:ViaService:
                  Fn::Join:
                    - ""
                    - - secretsmanager.
                      - Ref: AWS::Region
                      - .amazonaws.com
            Effect: Allow
            Principal:
              AWS:
                Fn::Join:
                  - ""
                  - - "arn:"
                    - Ref: AWS::Partition
                    - ":iam::"
                    - Ref: AWS::AccountId
                    - :root
            Resource: "*"
          - Action:
              - kms:CreateGrant
              - kms:DescribeKey
            Condition:
              StringEquals:
                kms:ViaService:
                  Fn::Join:
                    - ""
                    - - secretsmanager.
                      - Ref: AWS::Region
                      - .amazonaws.com
            Effect: Allow
            Principal:
              AWS:
                Fn::Join:
                  - ""
                  - - "arn:"
                    - Ref: AWS::Partition
                    - ":iam::"
                    - Ref: AWS::AccountId
                    - :root
            Resource: "*"
        Version: "2012-10-17"
      EnableKeyRotation: true
    DependsOn:
      - elasticachedemovpcIGWB2D9A7B9
      - elasticachedemovpcPrivateSubnet1DefaultRouteDA9519AA
      - elasticachedemovpcPrivateSubnet1RouteTable76CF92D5
      - elasticachedemovpcPrivateSubnet1RouteTableAssociationBD62AA3D
      - elasticachedemovpcPrivateSubnet1SubnetE60FDB9E
      - elasticachedemovpcPrivateSubnet2DefaultRouteEC61918F
      - elasticachedemovpcPrivateSubnet2RouteTableE90EB37E
      - elasticachedemovpcPrivateSubnet2RouteTableAssociationDCDB2982
      - elasticachedemovpcPrivateSubnet2SubnetB2DC7386
      - elasticachedemovpcPublicSubnet1DefaultRoute4434C510
      - elasticachedemovpcPublicSubnet1EIP5C0EAFC9
      - elasticachedemovpcPublicSubnet1NATGateway092A3D52
      - elasticachedemovpcPublicSubnet1RouteTable881099C5
      - elasticachedemovpcPublicSubnet1RouteTableAssociation642BA55F
      - elasticachedemovpcPublicSubnet1Subnet6D468D4B
      - elasticachedemovpcPublicSubnet2DefaultRoute66ADBDEF
      - elasticachedemovpcPublicSubnet2EIP4CF0D987
      - elasticachedemovpcPublicSubnet2NATGateway229D2CEB
      - elasticachedemovpcPublicSubnet2RouteTableEE1F746A
      - elasticachedemovpcPublicSubnet2RouteTableAssociationE703F9FB
      - elasticachedemovpcPublicSubnet2SubnetF31209E6
      - elasticachedemovpc9EEF29B7
      - elasticachedemovpcVPCGWA922A7FA
      - ElastiCacheSG1EAF1356
      - ElastiCacheSubnetGroup
    UpdateReplacePolicy: Retain
    DeletionPolicy: Retain
    Metadata:
      aws:cdk:path: RedisSecretRotationDemo/RedisRbacRotator/groupDefaultUser/kmsForSecret/Resource
  RedisRbacRotatorgroupDefaultUserkmsForSecretAlias1C5DA1BB:
    Type: AWS::KMS::Alias
    Properties:
      AliasName: alias/default
      TargetKeyId:
        Fn::GetAtt:
          - RedisRbacRotatorgroupDefaultUserkmsForSecretFBDC38AA
          - Arn
    DependsOn:
      - elasticachedemovpcIGWB2D9A7B9
      - elasticachedemovpcPrivateSubnet1DefaultRouteDA9519AA
      - elasticachedemovpcPrivateSubnet1RouteTable76CF92D5
      - elasticachedemovpcPrivateSubnet1RouteTableAssociationBD62AA3D
      - elasticachedemovpcPrivateSubnet1SubnetE60FDB9E
      - elasticachedemovpcPrivateSubnet2DefaultRouteEC61918F
      - elasticachedemovpcPrivateSubnet2RouteTableE90EB37E
      - elasticachedemovpcPrivateSubnet2RouteTableAssociationDCDB2982
      - elasticachedemovpcPrivateSubnet2SubnetB2DC7386
      - elasticachedemovpcPublicSubnet1DefaultRoute4434C510
      - elasticachedemovpcPublicSubnet1EIP5C0EAFC9
      - elasticachedemovpcPublicSubnet1NATGateway092A3D52
      - elasticachedemovpcPublicSubnet1RouteTable881099C5
      - elasticachedemovpcPublicSubnet1RouteTableAssociation642BA55F
      - elasticachedemovpcPublicSubnet1Subnet6D468D4B
      - elasticachedemovpcPublicSubnet2DefaultRoute66ADBDEF
      - elasticachedemovpcPublicSubnet2EIP4CF0D987
      - elasticachedemovpcPublicSubnet2NATGateway229D2CEB
      - elasticachedemovpcPublicSubnet2RouteTableEE1F746A
      - elasticachedemovpcPublicSubnet2RouteTableAssociationE703F9FB
      - elasticachedemovpcPublicSubnet2SubnetF31209E6
      - elasticachedemovpc9EEF29B7
      - elasticachedemovpcVPCGWA922A7FA
      - ElastiCacheSG1EAF1356
      - ElastiCacheSubnetGroup
    Metadata:
      aws:cdk:path: RedisSecretRotationDemo/RedisRbacRotator/groupDefaultUser/kmsForSecret/Alias/Resource
  RedisRbacRotatorgroupDefaultUsersecretEFE6A81F:
    Type: AWS::SecretsManager::Secret
    Properties:
      GenerateSecretString:
        ExcludeCharacters: "@%*()_+=`~{}|[]\\:\";'?,./"
        GenerateStringKey: password
        SecretStringTemplate: '{"username":"default"}'
      KmsKeyId:
        Fn::GetAtt:
          - RedisRbacRotatorgroupDefaultUserkmsForSecretFBDC38AA
          - Arn
    DependsOn:
      - elasticachedemovpcIGWB2D9A7B9
      - elasticachedemovpcPrivateSubnet1DefaultRouteDA9519AA
      - elasticachedemovpcPrivateSubnet1RouteTable76CF92D5
      - elasticachedemovpcPrivateSubnet1RouteTableAssociationBD62AA3D
      - elasticachedemovpcPrivateSubnet1SubnetE60FDB9E
      - elasticachedemovpcPrivateSubnet2DefaultRouteEC61918F
      - elasticachedemovpcPrivateSubnet2RouteTableE90EB37E
      - elasticachedemovpcPrivateSubnet2RouteTableAssociationDCDB2982
      - elasticachedemovpcPrivateSubnet2SubnetB2DC7386
      - elasticachedemovpcPublicSubnet1DefaultRoute4434C510
      - elasticachedemovpcPublicSubnet1EIP5C0EAFC9
      - elasticachedemovpcPublicSubnet1NATGateway092A3D52
      - elasticachedemovpcPublicSubnet1RouteTable881099C5
      - elasticachedemovpcPublicSubnet1RouteTableAssociation642BA55F
      - elasticachedemovpcPublicSubnet1Subnet6D468D4B
      - elasticachedemovpcPublicSubnet2DefaultRoute66ADBDEF
      - elasticachedemovpcPublicSubnet2EIP4CF0D987
      - elasticachedemovpcPublicSubnet2NATGateway229D2CEB
      - elasticachedemovpcPublicSubnet2RouteTableEE1F746A
      - elasticachedemovpcPublicSubnet2RouteTableAssociationE703F9FB
      - elasticachedemovpcPublicSubnet2SubnetF31209E6
      - elasticachedemovpc9EEF29B7
      - elasticachedemovpcVPCGWA922A7FA
      - ElastiCacheSG1EAF1356
      - ElastiCacheSubnetGroup
    UpdateReplacePolicy: Delete
    DeletionPolicy: Delete
    Metadata:
      aws:cdk:path: RedisSecretRotationDemo/RedisRbacRotator/groupDefaultUser/secret/Resource
  RedisRbacRotatorgroupDefaultUserredisuserC51FFE2B:
    Type: AWS::ElastiCache::User
    Properties:
      Engine: redis
      UserId: rotatordemodefaultuser
      UserName: default
      AccessString: off +get ~keys*
      Passwords:
        - Fn::Join:
            - ""
            - - "{{resolve:secretsmanager:"
              - Ref: RedisRbacRotatorgroupDefaultUsersecretEFE6A81F
              - :SecretString:password::}}
    DependsOn:
      - elasticachedemovpcIGWB2D9A7B9
      - elasticachedemovpcPrivateSubnet1DefaultRouteDA9519AA
      - elasticachedemovpcPrivateSubnet1RouteTable76CF92D5
      - elasticachedemovpcPrivateSubnet1RouteTableAssociationBD62AA3D
      - elasticachedemovpcPrivateSubnet1SubnetE60FDB9E
      - elasticachedemovpcPrivateSubnet2DefaultRouteEC61918F
      - elasticachedemovpcPrivateSubnet2RouteTableE90EB37E
      - elasticachedemovpcPrivateSubnet2RouteTableAssociationDCDB2982
      - elasticachedemovpcPrivateSubnet2SubnetB2DC7386
      - elasticachedemovpcPublicSubnet1DefaultRoute4434C510
      - elasticachedemovpcPublicSubnet1EIP5C0EAFC9
      - elasticachedemovpcPublicSubnet1NATGateway092A3D52
      - elasticachedemovpcPublicSubnet1RouteTable881099C5
      - elasticachedemovpcPublicSubnet1RouteTableAssociation642BA55F
      - elasticachedemovpcPublicSubnet1Subnet6D468D4B
      - elasticachedemovpcPublicSubnet2DefaultRoute66ADBDEF
      - elasticachedemovpcPublicSubnet2EIP4CF0D987
      - elasticachedemovpcPublicSubnet2NATGateway229D2CEB
      - elasticachedemovpcPublicSubnet2RouteTableEE1F746A
      - elasticachedemovpcPublicSubnet2RouteTableAssociationE703F9FB
      - elasticachedemovpcPublicSubnet2SubnetF31209E6
      - elasticachedemovpc9EEF29B7
      - elasticachedemovpcVPCGWA922A7FA
      - ElastiCacheSG1EAF1356
      - ElastiCacheSubnetGroup
      - RedisRbacRotatorgroupDefaultUsersecretEFE6A81F
    Metadata:
      aws:cdk:path: RedisSecretRotationDemo/RedisRbacRotator/groupDefaultUser/redisuser
  RedisRbacRotatorrotationTestUserGroupAEB27514:
    Type: AWS::ElastiCache::UserGroup
    Properties:
      Engine: redis
      UserGroupId: rotation-test-group
      UserIds:
        - rotationtestuser
        - rotatordemodefaultuser
        - anotherrotationtestuser
    DependsOn:
      - elasticachedemovpcIGWB2D9A7B9
      - elasticachedemovpcPrivateSubnet1DefaultRouteDA9519AA
      - elasticachedemovpcPrivateSubnet1RouteTable76CF92D5
      - elasticachedemovpcPrivateSubnet1RouteTableAssociationBD62AA3D
      - elasticachedemovpcPrivateSubnet1SubnetE60FDB9E
      - elasticachedemovpcPrivateSubnet2DefaultRouteEC61918F
      - elasticachedemovpcPrivateSubnet2RouteTableE90EB37E
      - elasticachedemovpcPrivateSubnet2RouteTableAssociationDCDB2982
      - elasticachedemovpcPrivateSubnet2SubnetB2DC7386
      - elasticachedemovpcPublicSubnet1DefaultRoute4434C510
      - elasticachedemovpcPublicSubnet1EIP5C0EAFC9
      - elasticachedemovpcPublicSubnet1NATGateway092A3D52
      - elasticachedemovpcPublicSubnet1RouteTable881099C5
      - elasticachedemovpcPublicSubnet1RouteTableAssociation642BA55F
      - elasticachedemovpcPublicSubnet1Subnet6D468D4B
      - elasticachedemovpcPublicSubnet2DefaultRoute66ADBDEF
      - elasticachedemovpcPublicSubnet2EIP4CF0D987
      - elasticachedemovpcPublicSubnet2NATGateway229D2CEB
      - elasticachedemovpcPublicSubnet2RouteTableEE1F746A
      - elasticachedemovpcPublicSubnet2RouteTableAssociationE703F9FB
      - elasticachedemovpcPublicSubnet2SubnetF31209E6
      - elasticachedemovpc9EEF29B7
      - elasticachedemovpcVPCGWA922A7FA
      - ElastiCacheSG1EAF1356
      - ElastiCacheSubnetGroup
      - RedisRbacRotatorgroupDefaultUserkmsForSecretAlias1C5DA1BB
      - RedisRbacRotatorgroupDefaultUserkmsForSecretFBDC38AA
      - RedisRbacRotatorgroupDefaultUserredisuserC51FFE2B
      - RedisRbacRotatorgroupDefaultUsersecretEFE6A81F
      - RedisRbacRotatorrotationtestuserRoleDefaultPolicy525A6C39
      - RedisRbacRotatorrotationtestuserRoleAB225CFA
    Metadata:
      aws:cdk:path: RedisSecretRotationDemo/RedisRbacRotator/rotationTestUserGroup
  RedisRbacRotatorRBACRotatorDemo20AE1247:
    Type: AWS::ElastiCache::ReplicationGroup
    Properties:
      ReplicationGroupDescription: RBACRotator-Demo
      AtRestEncryptionEnabled: true
      CacheNodeType: cache.m6g.large
      CacheSubnetGroupName:
        Ref: ElastiCacheSubnetGroup
      Engine: Redis
      EngineVersion: 6.x
      MultiAZEnabled: true
      NumNodeGroups: 1
      ReplicasPerNodeGroup: 1
      SecurityGroupIds:
        - Fn::GetAtt:
            - ElastiCacheSG1EAF1356
            - GroupId
      TransitEncryptionEnabled: true
      UserGroupIds:
        - rotation-test-group
    DependsOn:
      - elasticachedemovpcIGWB2D9A7B9
      - elasticachedemovpcPrivateSubnet1DefaultRouteDA9519AA
      - elasticachedemovpcPrivateSubnet1RouteTable76CF92D5
      - elasticachedemovpcPrivateSubnet1RouteTableAssociationBD62AA3D
      - elasticachedemovpcPrivateSubnet1SubnetE60FDB9E
      - elasticachedemovpcPrivateSubnet2DefaultRouteEC61918F
      - elasticachedemovpcPrivateSubnet2RouteTableE90EB37E
      - elasticachedemovpcPrivateSubnet2RouteTableAssociationDCDB2982
      - elasticachedemovpcPrivateSubnet2SubnetB2DC7386
      - elasticachedemovpcPublicSubnet1DefaultRoute4434C510
      - elasticachedemovpcPublicSubnet1EIP5C0EAFC9
      - elasticachedemovpcPublicSubnet1NATGateway092A3D52
      - elasticachedemovpcPublicSubnet1RouteTable881099C5
      - elasticachedemovpcPublicSubnet1RouteTableAssociation642BA55F
      - elasticachedemovpcPublicSubnet1Subnet6D468D4B
      - elasticachedemovpcPublicSubnet2DefaultRoute66ADBDEF
      - elasticachedemovpcPublicSubnet2EIP4CF0D987
      - elasticachedemovpcPublicSubnet2NATGateway229D2CEB
      - elasticachedemovpcPublicSubnet2RouteTableEE1F746A
      - elasticachedemovpcPublicSubnet2RouteTableAssociationE703F9FB
      - elasticachedemovpcPublicSubnet2SubnetF31209E6
      - elasticachedemovpc9EEF29B7
      - elasticachedemovpcVPCGWA922A7FA
      - ElastiCacheSG1EAF1356
      - ElastiCacheSubnetGroup
      - RedisRbacRotatorrotationTestUserGroupAEB27514
    Metadata:
      aws:cdk:path: RedisSecretRotationDemo/RedisRbacRotator/RBACRotator-Demo
  CDKMetadata:
    Type: AWS::CDK::Metadata
    Properties:
      Analytics: v2:deflate64:H4sIAAAAAAAA/2VSwW7CMAz9Fu4hULbDjmNoQ2jTVLUbd5MaFtomKHZAqOq/LymFMu1kv5dX+/UliZxNH+V09AwnGquinDTKOpRNzqBKkSFZ7xSKhTXEzisWcyLkcLrTZicWW5OCgxoZXQSDfmvCJ4VmbU0r4uwG1Uw264OKZ+t0IVKnj8CY+41BjuTQZdYzfsGmwoEfuODAKg1x9E0sUr+ptBpGvK7SWD6Bl2HJCc4RrUzwGQR3VHDSozmHX/6p0bDIUXmn+bx01h86C/dEK7ACYq2CPCR1c3hTZ3gIXjqDN+6bLgnF2k8hVA6ZajCwQxci73C/LnaZ5W5IHvYU/hLGP+4aeWrDzvP9JVyYVmioZZPZ6/ehDtqrpoJ6U4BsPuCMbo2O+nD/4Ddv1DX1+z5FV2ui7qrpYQzxhZDsHkrA8sWrEvkFCEVZk2zesVsdy7zSQBF0Tdu2wtgC5Z4mx+RJJjOZjPak9dh5w7pGmV3qL2zEybK1AgAA
    Metadata:
      aws:cdk:path: RedisSecretRotationDemo/CDKMetadata/Default
    Condition: CDKMetadataAvailable
Parameters:
  AssetParameters29b372f569db967448934a16e0b22a901d91823e60de1aa75dfc32a9372c323eS3Bucket813D4950:
    Type: String
    Description: S3 bucket for asset "29b372f569db967448934a16e0b22a901d91823e60de1aa75dfc32a9372c323e"
  AssetParameters29b372f569db967448934a16e0b22a901d91823e60de1aa75dfc32a9372c323eS3VersionKeyB4F5789F:
    Type: String
    Description: S3 key for asset version "29b372f569db967448934a16e0b22a901d91823e60de1aa75dfc32a9372c323e"
  AssetParameters29b372f569db967448934a16e0b22a901d91823e60de1aa75dfc32a9372c323eArtifactHashC691B8CA:
    Type: String
    Description: Artifact hash for asset "29b372f569db967448934a16e0b22a901d91823e60de1aa75dfc32a9372c323e"
  AssetParametersdf1a571af421557678aef2c18b1316d97ae39baba9bd90d216b0a805f818b2ffS3Bucket348682C2:
    Type: String
    Description: S3 bucket for asset "df1a571af421557678aef2c18b1316d97ae39baba9bd90d216b0a805f818b2ff"
  AssetParametersdf1a571af421557678aef2c18b1316d97ae39baba9bd90d216b0a805f818b2ffS3VersionKey27C6F591:
    Type: String
    Description: S3 key for asset version "df1a571af421557678aef2c18b1316d97ae39baba9bd90d216b0a805f818b2ff"
  AssetParametersdf1a571af421557678aef2c18b1316d97ae39baba9bd90d216b0a805f818b2ffArtifactHash29DB6CA0:
    Type: String
    Description: Artifact hash for asset "df1a571af421557678aef2c18b1316d97ae39baba9bd90d216b0a805f818b2ff"
  AssetParameterscfdb3eaf890438a197a89004dd2089e43566354309400047947a5898767aa00bS3BucketD8229B72:
    Type: String
    Description: S3 bucket for asset "cfdb3eaf890438a197a89004dd2089e43566354309400047947a5898767aa00b"
  AssetParameterscfdb3eaf890438a197a89004dd2089e43566354309400047947a5898767aa00bS3VersionKeyD6281FE0:
    Type: String
    Description: S3 key for asset version "cfdb3eaf890438a197a89004dd2089e43566354309400047947a5898767aa00b"
  AssetParameterscfdb3eaf890438a197a89004dd2089e43566354309400047947a5898767aa00bArtifactHashDBE90250:
    Type: String
    Description: Artifact hash for asset "cfdb3eaf890438a197a89004dd2089e43566354309400047947a5898767aa00b"
Conditions:
  CDKMetadataAvailable:
    Fn::Or:
      - Fn::Or:
          - Fn::Equals:
              - Ref: AWS::Region
              - af-south-1
          - Fn::Equals:
              - Ref: AWS::Region
              - ap-east-1
          - Fn::Equals:
              - Ref: AWS::Region
              - ap-northeast-1
          - Fn::Equals:
              - Ref: AWS::Region
              - ap-northeast-2
          - Fn::Equals:
              - Ref: AWS::Region
              - ap-south-1
          - Fn::Equals:
              - Ref: AWS::Region
              - ap-southeast-1
          - Fn::Equals:
              - Ref: AWS::Region
              - ap-southeast-2
          - Fn::Equals:
              - Ref: AWS::Region
              - ca-central-1
          - Fn::Equals:
              - Ref: AWS::Region
              - cn-north-1
          - Fn::Equals:
              - Ref: AWS::Region
              - cn-northwest-1
      - Fn::Or:
          - Fn::Equals:
              - Ref: AWS::Region
              - eu-central-1
          - Fn::Equals:
              - Ref: AWS::Region
              - eu-north-1
          - Fn::Equals:
              - Ref: AWS::Region
              - eu-south-1
          - Fn::Equals:
              - Ref: AWS::Region
              - eu-west-1
          - Fn::Equals:
              - Ref: AWS::Region
              - eu-west-2
          - Fn::Equals:
              - Ref: AWS::Region
              - eu-west-3
          - Fn::Equals:
              - Ref: AWS::Region
              - me-south-1
          - Fn::Equals:
              - Ref: AWS::Region
              - sa-east-1
          - Fn::Equals:
              - Ref: AWS::Region
              - us-east-1
          - Fn::Equals:
              - Ref: AWS::Region
              - us-east-2
      - Fn::Or:
          - Fn::Equals:
              - Ref: AWS::Region
              - us-west-1
          - Fn::Equals:
              - Ref: AWS::Region
              - us-west-2

